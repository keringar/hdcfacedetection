<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BitMagic-C++: xsample07a.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BitMagic-C++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">xsample07a.cpp</div></div>
</div><!--header-->
<div class="contents">
<p >Use of bvector&lt;&gt; for k-mer fingerprint K should be short, no minimizers here</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Copyright(c) 2002-2020 Anatoliy Kuznetsov(anatoliy_kuznetsov at yahoo.com)</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment">you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment">You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment">See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment">limitations under the License.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">For more information please visit:  http://bitmagic.io</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/** \example xsample07a.cpp</span></div>
<div class="line"><span class="comment">    Use of bvector&lt;&gt; for k-mer fingerprint K should be short,</span></div>
<div class="line"><span class="comment">    no minimizers here</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/*! \file xsample07a.cpp</span></div>
<div class="line"><span class="comment">    \brief Example: Use of bvector&lt;&gt; for k-mer fingerprint</span></div>
<div class="line"><span class="comment">    K should be short, no minimizers here (k &lt; 24)</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    Example loads FASTA file (large multi-molecule file is expected,</span></div>
<div class="line"><span class="comment">    builds a collection of k-mers for each molecule and runs</span></div>
<div class="line"><span class="comment">    clusterization algorithm on the input collection using</span></div>
<div class="line"><span class="comment">    set intersect (logical AND) as a similarity measure.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    Example uses std::async for running parallel jobs.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;future&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;bm64.h&quot;</span>  <span class="comment">// use 48-bit vectors</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmalgo_8h.html">bmalgo.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmserial_8h.html">bmserial.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmaggregator_8h.html">bmaggregator.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmsparsevec__compr_8h.html">bmsparsevec_compr.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmsparsevec__algo_8h.html">bmsparsevec_algo.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmrandom_8h.html">bmrandom.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// BitMagic utilities for debug and timings</span></div>
<div class="line"><span class="preprocessor">#include &quot;bmdbg.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmtimer_8h.html">bmtimer.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="bmundef_8h.html">bmundef.h</a>&quot;</span> <span class="comment">/* clear the pre-proc defines from BM */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;dna_finger.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Arguments</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">std::string  <a name="a0"></a><a class="code" href="xsample07a_8cpp.html#a9988650f5c236d5a70e710498d62904c">ifa_name</a>;</div>
<div class="line">std::string  <a name="a1"></a><a class="code" href="xsample07a_8cpp.html#a9af53e7294c27eb2b80c9e99204e9c09">ikd_name</a>;</div>
<div class="line">std::string  <a name="a2"></a><a class="code" href="xsample07a_8cpp.html#a9651708880643e05b74b997d6b3048d4">ikd_counts_name</a>;</div>
<div class="line">std::string  <a name="a3"></a><a class="code" href="xsample07a_8cpp.html#a540384e904d19ef31d71381b604fedf5">kh_name</a>;</div>
<div class="line">std::string  <a name="a4"></a><a class="code" href="xsample07a_8cpp.html#a2f9e440e48637e03efd999efc9b352fc">ikd_rep_name</a>;</div>
<div class="line">std::string  <a name="a5"></a><a class="code" href="xsample07a_8cpp.html#a8ec9c8a1508f6c641c7de6368a3b0f9d">ikd_freq_name</a>;</div>
<div class="line"><span class="keywordtype">bool</span>         <a name="a6"></a><a class="code" href="xsample07a_8cpp.html#aa592d3fbead57ca8423ac5caaccada07">is_diag</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">bool</span>         <a name="a7"></a><a class="code" href="xsample07a_8cpp.html#aece8e90d91aaea144d41103f7d2825ee">is_timing</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">bool</span>         <a name="a8"></a><a class="code" href="xsample07a_8cpp.html#a4dd1e4b402061691109d356faa4513b5">is_bench</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">unsigned</span>     <a name="a9"></a><a class="code" href="xsample07a_8cpp.html#a383b271ee467c0977c3fe28a579c5454">ik_size</a> = 8;</div>
<div class="line"><span class="keywordtype">unsigned</span>     <a name="a10"></a><a class="code" href="xsample07a_8cpp.html#aeb19f159bbe1dcac8757cbf6b8c9a334">parallel_jobs</a> = 4;</div>
<div class="line"><span class="keywordtype">unsigned</span>     <a name="a11"></a><a class="code" href="xsample07a_8cpp.html#acd6b21dd706256a4f0512068b8fe5e35">f_percent</a> = 5; <span class="comment">// percent of k-mers we try to clear as over-represented</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cmd_args.h&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Global types</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">typedef</span> <a name="_a12"></a><a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>                                 <a name="a13"></a><a class="code" href="xsample07a_8cpp.html#a4ca03dfc387c36e69ea916426572acdc">bvector_type</a>;</div>
<div class="line"><span class="keyword">typedef</span> std::vector&lt;char&gt;                             <a name="a14"></a><a class="code" href="xsample07a_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>;</div>
<div class="line"><span class="keyword">typedef</span> bm::dynamic_heap_matrix&lt;unsigned, bm::bvector&lt;&gt;::allocator_type&gt; <a name="a15"></a><a class="code" href="xsample07a_8cpp.html#a86fb99116b47ce90217491648448fa46">distance_matrix_type</a>;</div>
<div class="line"><span class="keyword">typedef</span> std::vector&lt;std::unique_ptr&lt;bvector_type&gt; &gt;   <a name="a16"></a><a class="code" href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a>;</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bvector_type::size_type</a>                       <a name="a17"></a><a class="code" href="xsample07a_8cpp.html#a0ffef2be9bf95d1f3f5ffaf6d6489456">bv_size_type</a>;</div>
<div class="line"><span class="keyword">typedef</span> std::vector&lt;std::pair&lt;bv_size_type, bv_size_type&gt; &gt; <a name="a18"></a><a class="code" href="xsample07a_8cpp.html#a7abca04faa4bc9e482801161aed87e64">bv_ranges_vector</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Global vars</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><a class="code" href="classbm_1_1chrono__taker.html#a952d06d260d1c98f95056e871bb8d3a0">bm::chrono_taker&lt;&gt;::duration_map_type</a>     <a name="a19"></a><a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// wait for any opening in a list of futures</span></div>
<div class="line"><span class="comment">///    used to schedule parallel tasks with CPU overbooking control</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> FV&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a name="a20"></a><a class="code" href="xsample07a_8cpp.html#a375552213e6e0f946f44c3c19520df7f">wait_for_slot</a>(FV&amp; futures, <span class="keywordtype">unsigned</span>* parallel_cnt, <span class="keywordtype">unsigned</span> concurrency)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> e = futures.begin(); e != futures.end(); ++e)</div>
<div class="line">        {</div>
<div class="line">            std::future_status status = e-&gt;wait_for(std::chrono::milliseconds(100));</div>
<div class="line">            <span class="keywordflow">if</span> (status == std::future_status::ready)</div>
<div class="line">            {</div>
<div class="line">                (*parallel_cnt) -= 1;</div>
<div class="line">                futures.erase(e);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">// for e</span></div>
<div class="line">    } <span class="keywordflow">while</span> (*parallel_cnt &gt;= concurrency);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Collection of sequences and k-mer fingerprint vectors</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span><a name="_a21"></a><a class="code" href="classCSequenceColl.html">CSequenceColl</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">typedef</span> std::vector&lt;unsigned char&gt; <a name="a22"></a><a class="code" href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">buffer_type</a>;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    <a name="a23"></a><a class="code" href="classCSequenceColl.html#ac0a3e3e273980d2799450f43b6a54aff">CSequenceColl</a>()</div>
<div class="line">    {}</div>
<div class="line">    <a class="code" href="classCSequenceColl.html#ac0a3e3e273980d2799450f43b6a54aff">CSequenceColl</a>(<span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a24"></a><a class="code" href="classCSequenceColl.html#a29a07b14da0a706004fbee21f2d7e9cd">add_sequence</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; acc, <a class="code" href="xsample06_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>* seq_ptr)</div>
<div class="line">    {</div>
<div class="line">        m_acc.push_back(acc);</div>
<div class="line">        m_seqs.emplace_back(seq_ptr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a25"></a><a class="code" href="classCSequenceColl.html#ae555e53331885b0093c4991dec44730d">set_buffer</a>(<span class="keywordtype">size_t</span> i, <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">buffer_type</a>&amp; buf)</div>
<div class="line">    {</div>
<div class="line">        unique_ptr&lt;buffer_type&gt; buf_ptr(<span class="keyword">new</span> <a class="code" href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">buffer_type</a>(buf));</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">static</span> std::mutex   mtx_counts_lock;</div>
<div class="line">            std::lock_guard&lt;std::mutex&gt; guard(mtx_counts_lock);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (m_kmer_bufs.size() &lt;= i)</div>
<div class="line">                m_kmer_bufs.resize(i+1);</div>
<div class="line">            m_kmer_bufs[i].reset(buf_ptr.release());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">void</span> <a name="a26"></a><a class="code" href="classCSequenceColl.html#ad0355451628e1cad6a30b00dd5917c23">sync_buffers_size</a>()</div>
<div class="line">    {</div>
<div class="line">        m_kmer_bufs.resize(this-&gt;<a name="a27"></a><a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> <a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">        </span>{ assert(m_seqs.size() == m_acc.size()); <span class="keywordflow">return</span> m_seqs.size(); }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <a name="a28"></a><a class="code" href="classCSequenceColl.html#acc61c9285b49db25ae9d1f99ccad6bee">get_acc</a>(<span class="keywordtype">size_t</span> i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_acc[i]; }</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="xsample06_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>&amp; <a name="a29"></a><a class="code" href="classCSequenceColl.html#a939e26988240fa9be32579a5e8b228d0">get_sequence</a>(<span class="keywordtype">size_t</span> i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *(m_seqs[i]); }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> <a name="a30"></a><a class="code" href="classCSequenceColl.html#ab2e69c59e59ac6fcac55e077fc5aed05">seq_size</a>(<span class="keywordtype">size_t</span> i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_seqs[i]-&gt;size(); }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> <a name="a31"></a><a class="code" href="classCSequenceColl.html#a50104368c650b21bc0251d67db4da4cf">total_seq_size</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordtype">size_t</span> sum = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_seqs.size(); ++i)</div>
<div class="line">            sum += <a class="code" href="classCSequenceColl.html#ab2e69c59e59ac6fcac55e077fc5aed05">seq_size</a>(i);</div>
<div class="line">        <span class="keywordflow">return</span> sum;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    ///</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">size_t</span> <a name="a32"></a><a class="code" href="classCSequenceColl.html#aad175e6424b73bda2f736b5dd30d43d1">buf_size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_kmer_bufs.size(); }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Get k-mer vector BLOB size</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">size_t</span> <a name="a33"></a><a class="code" href="classCSequenceColl.html#aa44fdfaddf73a6eb2076c59cad656bae">get_buf_size</a>(<span class="keywordtype">size_t</span> i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_kmer_bufs[i]-&gt;size(); }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Get k-mer BLOB pointer</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a name="a34"></a><a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(<span class="keywordtype">size_t</span> i)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">buffer_type</a>* p =  m_kmer_bufs[i].get();</div>
<div class="line">        <span class="keywordflow">if</span> (!p)</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">return</span> p-&gt;data();</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Deserialize group of k-mer fingerprint vectors</span></div>
<div class="line"><span class="comment">    ///</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a35"></a><a class="code" href="classCSequenceColl.html#a4fcafecf4680670641820eb42d8d38fe">deserialize_k_mers</a>(<a class="code" href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a>&amp; k_mers_vect,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_req,</div>
<div class="line">                            <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> bv_req_count) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    vector&lt;unique_ptr&lt;vector_char_type&gt; &gt; m_seqs;</div>
<div class="line">    vector&lt;string&gt;                        m_acc;</div>
<div class="line">    vector&lt;unique_ptr&lt;buffer_type&gt; &gt;      m_kmer_bufs;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSequenceColl.html#a4fcafecf4680670641820eb42d8d38fe">CSequenceColl::deserialize_k_mers</a>(<a class="code" href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a>&amp; k_mers_vect,</div>
<div class="line">                                       <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_req,</div>
<div class="line">                                <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> bv_req_count)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line"> </div>
<div class="line">    k_mers_vect.resize(0);</div>
<div class="line">    k_mers_vect.reserve(bv_req_count);</div>
<div class="line"> </div>
<div class="line">    <a name="_a36"></a><a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en(bv_req.<a name="a37"></a><a class="code" href="classbm_1_1bvector.html#a86b939f3aed555dc073e8c26e9efea71">first</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (; en.valid(); ++en)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> i_idx = *en;</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv = <span class="keyword">new</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>(); <span class="comment">// k-mer fingerprint</span></div>
<div class="line">        k_mers_vect.emplace_back(bv);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = this-&gt;<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(i_idx);</div>
<div class="line">        <span class="keywordflow">if</span> (!buf)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        futures.emplace_back(                      <span class="comment">// async decompress</span></div>
<div class="line">            std::async(std::launch::async,</div>
<div class="line">            [bv, buf]()</div>
<div class="line">            { <a name="a38"></a><a class="code" href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a>(tb); <a name="a39"></a><a class="code" href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a>(*bv, buf, tb); }</div>
<div class="line">            ));</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// for en</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures)</div>
<div class="line">        e.wait();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Load multi-sequence FASTA</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">int</span> <a name="a40"></a><a class="code" href="xsample07a_8cpp.html#a57fb672ff6d3e743da75e0d98120e714">load_FASTA</a>(<span class="keyword">const</span> std::string&amp; fname, <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll)</div>
<div class="line">{</div>
<div class="line">    unique_ptr&lt;vector_char_type&gt; seq_vect(<span class="keyword">new</span> <a class="code" href="xsample07a_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>());</div>
<div class="line">    std::string line, acc;</div>
<div class="line"> </div>
<div class="line">    std::ifstream fin(fname.c_str(), std::ios::in);</div>
<div class="line">    <span class="keywordflow">if</span> (!fin.good())</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; std::getline(fin, line); ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (line.empty())</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (line.front() == <span class="charliteral">&#39;&gt;&#39;</span>) <span class="comment">// defline</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (!acc.empty())</div>
<div class="line">            {</div>
<div class="line">                seq_vect-&gt;shrink_to_fit();</div>
<div class="line">                seq_coll.<a class="code" href="classCSequenceColl.html#a29a07b14da0a706004fbee21f2d7e9cd">add_sequence</a>(acc, seq_vect.release());</div>
<div class="line">                acc.resize(0);</div>
<div class="line">                seq_vect.reset(<span class="keyword">new</span> <a class="code" href="xsample07a_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>());</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            std::size_t pos = line.find_first_of(<span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (pos == std::string::npos) <span class="comment">// not found</span></div>
<div class="line">            {</div>
<div class="line">                acc = line;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                acc = line.substr(1, pos-1);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (std::string::iterator it = line.begin(); it != line.end(); ++it)</div>
<div class="line">            seq_vect-&gt;push_back(*it);</div>
<div class="line">    } <span class="comment">// for</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!acc.empty())</div>
<div class="line">    {</div>
<div class="line">        seq_vect-&gt;shrink_to_fit();</div>
<div class="line">        seq_coll.<a class="code" href="classCSequenceColl.html#a29a07b14da0a706004fbee21f2d7e9cd">add_sequence</a>(acc, seq_vect.release());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;\r                            \r&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// save k-mer vectors to a file</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a41"></a><a class="code" href="xsample07a_8cpp.html#a3f1ef71b34674c4f7926bc05778037c7">save_kmer_buffers</a>(<span class="keyword">const</span> std::string&amp; fname, <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> magic_ch = <span class="charliteral">&#39;\t&#39;</span>;</div>
<div class="line">    std::ofstream bfile (fname, std::ios::out | std::ios::binary);</div>
<div class="line">    <span class="keywordflow">if</span> (!bfile.good())</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot open file for write: &quot;</span> &lt;&lt; fname &lt;&lt; std::endl;</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// save collection size</span></div>
<div class="line">    <span class="keywordtype">size_t</span> sz = seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>();</div>
<div class="line">    bfile.write((<span class="keywordtype">char</span>*)&amp;sz, std::streamsize(<span class="keyword">sizeof</span>(sz)));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// save the collection elements</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sz; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">size_t</span> buf_size = 0;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(i);</div>
<div class="line">        <span class="keywordflow">if</span> (!buf)</div>
<div class="line">        {</div>
<div class="line">            bfile.write((<span class="keywordtype">char</span>*)&amp;buf_size, std::streamsize(<span class="keyword">sizeof</span>(buf_size)));</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        buf_size = seq_coll.<a class="code" href="classCSequenceColl.html#aa44fdfaddf73a6eb2076c59cad656bae">get_buf_size</a>(i);</div>
<div class="line">        bfile.write((<span class="keywordtype">char</span>*)&amp;buf_size, std::streamsize(<span class="keyword">sizeof</span>(buf_size)));</div>
<div class="line">        <span class="keywordflow">if</span> (buf_size)</div>
<div class="line">        {</div>
<div class="line">            bfile.write((<span class="keywordtype">char</span>*)buf, std::streamsize(buf_size));</div>
<div class="line">            bfile.write((<span class="keywordtype">char</span>*)&amp;magic_ch, 1);</div>
<div class="line">        }</div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Load k-mer vectors</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a42"></a><a class="code" href="xsample07a_8cpp.html#a804134333821912f3013d1ab32f3e956">load_kmer_buffers</a>(<span class="keyword">const</span> std::string&amp; fname, <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> magic_ch = <span class="charliteral">&#39;\t&#39;</span>;</div>
<div class="line">    std::ifstream bfile (fname, std::ios::in | std::ios::binary);</div>
<div class="line">    <span class="keywordflow">if</span> (!bfile.good())</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Cannot open file for read: &quot;</span> &lt;&lt; fname &lt;&lt; std::endl;</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// save collection size</span></div>
<div class="line">    <span class="keywordtype">size_t</span> sz;</div>
<div class="line">    bfile.read((<span class="keywordtype">char</span>*)&amp;sz, std::streamsize(<span class="keyword">sizeof</span>(sz)));</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">CSequenceColl::buffer_type</a> buf;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// load the collection elements</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sz; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">size_t</span> buf_size = 0;</div>
<div class="line">        bfile.read((<span class="keywordtype">char</span>*)&amp;buf_size, std::streamsize(<span class="keyword">sizeof</span>(buf_size)));</div>
<div class="line">        <span class="keywordflow">if</span> (buf_size)</div>
<div class="line">        {</div>
<div class="line">            buf.resize(buf_size);</div>
<div class="line">            bfile.read((<span class="keywordtype">char</span>*) buf.data(), std::streamsize(buf_size));</div>
<div class="line">            <span class="keywordtype">char</span> control_ch = 0;</div>
<div class="line">            bfile.read((<span class="keywordtype">char</span>*)&amp;control_ch, 1);</div>
<div class="line">            <span class="keywordflow">if</span> (control_ch != magic_ch)</div>
<div class="line">            {</div>
<div class="line">                cerr &lt;&lt; <span class="stringliteral">&quot;Error: read failure!&quot;</span> &lt;&lt; endl;</div>
<div class="line">                exit(1);</div>
<div class="line">            }</div>
<div class="line">            seq_coll.<a class="code" href="classCSequenceColl.html#ae555e53331885b0093c4991dec44730d">set_buffer</a>(i, buf);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">inline</span></div>
<div class="line"><span class="keywordtype">bool</span> <a name="a43"></a><a class="code" href="xsample07a_8cpp.html#aec839c8041cd92d6a5d1d70e914c53bd">get_DNA_code</a>(<span class="keywordtype">char</span> bp, <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a>&amp; dna_code)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (bp)</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">        dna_code = 0; <span class="comment">// 00</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:</div>
<div class="line">        dna_code = 1; <span class="comment">// 01</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>:</div>
<div class="line">        dna_code = 2; <span class="comment">// 10</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">        dna_code = 3; <span class="comment">// 11</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>: <span class="comment">// ambiguity codes are ignored (for simplicity)</span></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Calculate k-mer as an unsigned long integer</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// @return true - if k-mer is &quot;true&quot; (not &#39;NNNNNN&#39;)</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">inline</span></div>
<div class="line"><span class="keywordtype">bool</span> <a name="a44"></a><a class="code" href="xsample07a_8cpp.html#a9c117ca08d50ad62cf8520af2f1e60d7">get_kmer_code</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* dna,</div>
<div class="line">                  <span class="keywordtype">size_t</span> pos, <span class="keywordtype">unsigned</span> k_size,</div>
<div class="line">                  <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a>&amp; k_mer)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// generate k-mer</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> k_acc = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> shift = 0;</div>
<div class="line">    dna += pos;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; k_size; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">char</span> bp = dna[i];</div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> dna_code;</div>
<div class="line">        <span class="keywordtype">bool</span> valid = <a class="code" href="xsample07a_8cpp.html#aec839c8041cd92d6a5d1d70e914c53bd">get_DNA_code</a>(bp, dna_code);</div>
<div class="line">        <span class="keywordflow">if</span> (!valid)</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        k_acc |= (dna_code &lt;&lt; shift); <span class="comment">// accumulate new code within 64-bit accum</span></div>
<div class="line">        shift += 2; <span class="comment">// each DNA base pair needs 2-bits to store</span></div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line">    k_mer = k_acc;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Translate integer code to DNA letter</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">inline</span></div>
<div class="line"><span class="keywordtype">char</span> <a name="a45"></a><a class="code" href="xsample07a_8cpp.html#aa961816c64399d669effbc66f555da72">int2DNA</a>(<span class="keywordtype">unsigned</span> code)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> lut[] = { <span class="charliteral">&#39;A&#39;</span>, <span class="charliteral">&#39;T&#39;</span>, <span class="charliteral">&#39;G&#39;</span>, <span class="charliteral">&#39;C&#39;</span>, <span class="charliteral">&#39;N&#39;</span>, <span class="charliteral">&#39;M&#39;</span>, <span class="charliteral">&#39;$&#39;</span> };</div>
<div class="line">    <span class="keywordflow">if</span> (code &lt; 5)</div>
<div class="line">        <span class="keywordflow">return</span> lut[code];</div>
<div class="line">    assert(0);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="charliteral">&#39;N&#39;</span>;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Translate k-mer code into ATGC DNA string</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment">/// @param dna    - target string</span></div>
<div class="line"><span class="comment">/// @param k_mer  - k-mer code</span></div>
<div class="line"><span class="comment">/// @param k_size -</span></div>
<div class="line"><span class="comment"></span><span class="keyword">inline</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a46"></a><a class="code" href="xsample07a_8cpp.html#a38e5de3cf4f88f0f731946f091eb5849">translate_kmer</a>(std::string&amp; dna, <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> kmer_code, <span class="keywordtype">unsigned</span> k_size)</div>
<div class="line">{</div>
<div class="line">    dna.resize(k_size);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; k_size; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">unsigned</span> dna_code = unsigned(kmer_code &amp; 3);</div>
<div class="line">        <span class="keywordtype">char</span> bp = <a class="code" href="xsample07a_8cpp.html#aa961816c64399d669effbc66f555da72">int2DNA</a>(dna_code);</div>
<div class="line">        dna[i] = bp;</div>
<div class="line">        kmer_code &gt;&gt;= 2;</div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line">    assert(!kmer_code);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment">    This function turns each k-mer into an integer number and encodes it</span></div>
<div class="line"><span class="comment">    in a bit-vector (presense vector)</span></div>
<div class="line"><span class="comment">    The natural limitation here is that integer has to be less tha 48-bits</span></div>
<div class="line"><span class="comment">    (limitations of bm::bvector&lt;&gt;)</span></div>
<div class="line"><span class="comment">    This method build a presense k-mer fingerprint vector which can be</span></div>
<div class="line"><span class="comment">    used for Jaccard distance comparison.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    @param bv - [out] - target bit-vector</span></div>
<div class="line"><span class="comment">    @param seq_vect - [out] DNA sequence vector</span></div>
<div class="line"><span class="comment">    @param k-size   - dimention for k-mer generation</span></div>
<div class="line"><span class="comment">    @param k_buf    - sort buffer for generated k-mers</span></div>
<div class="line"><span class="comment">    @param chunk_size - sort buffer size (number of k-mers per sort)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> BV&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a name="a47"></a><a class="code" href="xsample07a_8cpp.html#ac02c2935dcf3510be1130c2222f75247">generate_k_mer_bvector</a>(BV&amp; bv,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="xsample06_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>&amp; seq_vect,</div>
<div class="line">                            <span class="keywordtype">unsigned</span> k_size,</div>
<div class="line">                            std::vector&lt;bm::id64_t&gt;&amp; k_buf,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> chunk_size = 400000000</div>
<div class="line">                            )</div>
<div class="line">{</div>
<div class="line">    bv.clear();</div>
<div class="line">    bv.init(); <span class="comment">// need to explicitly init to use bvector&lt;&gt;::set_bit_no_check()</span></div>
<div class="line">    <span class="keywordflow">if</span> (seq_vect.empty())</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* dna_str = &amp;seq_vect[0];</div>
<div class="line"> </div>
<div class="line">    k_buf.reserve(<span class="keywordtype">size_t</span>(chunk_size));</div>
<div class="line">    k_buf.resize(0);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> k_mer_code;</div>
<div class="line">        vector_char_type::size_type dna_sz = seq_vect.size()-(k_size-1);</div>
<div class="line">        vector_char_type::size_type pos = 0;</div>
<div class="line">        <span class="keywordtype">bool</span> valid = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (; pos &lt; dna_sz; ++pos)</div>
<div class="line">        {</div>
<div class="line">            valid = <a class="code" href="xsample07a_8cpp.html#a9c117ca08d50ad62cf8520af2f1e60d7">get_kmer_code</a>(dna_str, pos, k_size, k_mer_code);</div>
<div class="line">            <span class="keywordflow">if</span> (valid)</div>
<div class="line">            {</div>
<div class="line">                k_buf.push_back(k_mer_code);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">// for pos</span></div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> k_shift = (k_size-1) * 2;</div>
<div class="line">        <span class="keywordflow">if</span> (valid)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (++pos; pos &lt; dna_sz; ++pos)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> bp_code;</div>
<div class="line">                valid = <a class="code" href="xsample07a_8cpp.html#aec839c8041cd92d6a5d1d70e914c53bd">get_DNA_code</a>(dna_str[pos + (k_size - 1)],  bp_code);</div>
<div class="line">                <span class="keywordflow">if</span> (!valid)</div>
<div class="line">                {</div>
<div class="line">                    pos += k_size; <span class="comment">// wind fwrd to the next BP char</span></div>
<div class="line">                    <span class="keywordflow">for</span> (; pos &lt; dna_sz; ++pos) <span class="comment">// search for the next valid k-mer</span></div>
<div class="line">                    {</div>
<div class="line">                        valid = <a class="code" href="xsample07a_8cpp.html#a9c117ca08d50ad62cf8520af2f1e60d7">get_kmer_code</a>(dna_str, pos, k_size, k_mer_code);</div>
<div class="line">                        <span class="keywordflow">if</span> (valid)</div>
<div class="line">                        {</div>
<div class="line">                            k_buf.push_back(k_mer_code);</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// shift out the previous base pair code, OR the new arrival</span></div>
<div class="line">                k_mer_code = ((k_mer_code &gt;&gt; 2) | (bp_code &lt;&lt; k_shift));</div>
<div class="line">                <span class="comment">// generated k-mer codes are accumulated in buffer for sorting</span></div>
<div class="line">                k_buf.push_back(k_mer_code);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (k_buf.size() == chunk_size) <span class="comment">// soring check.point</span></div>
<div class="line">                {</div>
<div class="line">                    std::sort(k_buf.begin(), k_buf.end());</div>
<div class="line">                    <span class="keywordflow">if</span> (k_buf.size())</div>
<div class="line">                    {</div>
<div class="line">                        bv.set(&amp;k_buf[0], k_buf.size(), <a name="a48"></a><a class="code" href="group__bvector.html#gga04a7a7cda4bf04cd107e198b3b1e4ed8a78505da4a29a1a7e3381d9d28d41953e">bm::BM_SORTED</a>); <span class="comment">// fast bulk set</span></div>
<div class="line">                        k_buf.resize(0);</div>
<div class="line">                        bv.optimize(); <span class="comment">// periodically re-optimize to save memory</span></div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                    <span class="keywordtype">float</span> pcnt = float(pos) / float(dna_sz);</div>
<div class="line">                    pcnt *= 100;</div>
<div class="line">                    cout &lt;&lt; <span class="stringliteral">&quot;\r&quot;</span> &lt;&lt; unsigned(pcnt) &lt;&lt; <span class="stringliteral">&quot;% of &quot;</span> &lt;&lt; dna_sz</div>
<div class="line">                         &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; (pos+1) &lt;&lt;<span class="stringliteral">&quot;)    &quot;</span></div>
<div class="line">                         &lt;&lt; flush;</div>
<div class="line">                }</div>
<div class="line">            } <span class="comment">// for pos</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (k_buf.size()) <span class="comment">// add last incomplete chunk here</span></div>
<div class="line">        {</div>
<div class="line">            std::sort(k_buf.begin(), k_buf.end());</div>
<div class="line">            bv.set(&amp;k_buf[0], k_buf.size(), <a class="code" href="group__bvector.html#gga04a7a7cda4bf04cd107e198b3b1e4ed8a78505da4a29a1a7e3381d9d28d41953e">bm::BM_SORTED</a>); <span class="comment">// fast bulk set</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::atomic_ullong                      <a name="a49"></a><a class="code" href="xsample07a_8cpp.html#af667eb15b7b3d2db6766614694c71546">k_mer_progress_count</a>(0);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a50"></a><a class="code" href="xsample07a_8cpp.html#a215ea2e60054a2ccc30a0f8b1e8a4dfc">generate_k_mers</a>(<a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll, <span class="keywordtype">unsigned</span> k_size,</div>
<div class="line">                     <span class="keywordtype">size_t</span> from, <span class="keywordtype">size_t</span> to)</div>
<div class="line">{</div>
<div class="line">    assert(from &lt;= to);</div>
<div class="line">    <span class="keywordflow">if</span> (!seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>() || (from &gt;= seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>()))</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;bm::id64_t&gt; k_buf; <span class="comment">// sort buffer</span></div>
<div class="line">    <a class="code" href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a>(tb)</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">CSequenceColl::buffer_type</a> buf;</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="classbm_1_1bvector.html#ad1dbe63690fd5cd2b1e064795d3f1b6c">bm::bvector&lt;&gt;::allocator_type</a>        allocator_type;</div>
<div class="line">    <span class="keyword">typedef</span> allocator_type::allocator_pool_type  allocator_pool_type;</div>
<div class="line">    allocator_pool_type  pool; <span class="comment">// local pool for blocks</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv;</div>
<div class="line">    <a name="_a51"></a><a class="code" href="classbm_1_1bvector_1_1mem__pool__guard.html">bm::bvector&lt;&gt;::mem_pool_guard</a> mp_guard_bv; <span class="comment">// memory pool reduces allocation calls to heap</span></div>
<div class="line">    mp_guard_bv.<a name="a52"></a><a class="code" href="classbm_1_1bvector_1_1mem__pool__guard.html#a41c7e5db1df7b29b0fbc37c75ac826b1">assign_if_not_set</a>(pool, bv);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!to || to &gt;= seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>())</div>
<div class="line">        to = seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>()-1;</div>
<div class="line"> </div>
<div class="line">    <a name="_a53"></a><a class="code" href="classbm_1_1serializer.html">bm::serializer&lt;bm::bvector&lt;&gt;</a> &gt; bvs; <span class="comment">// serializer object</span></div>
<div class="line">    bvs.<a name="a54"></a><a class="code" href="classbm_1_1serializer.html#a89cebac62eb991ee3f4a5b805a255e81">set_bookmarks</a>(<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> cnt = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = from; i &lt;= to; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="xsample06_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a>&amp; seq_vect = seq_coll.<a class="code" href="classCSequenceColl.html#a939e26988240fa9be32579a5e8b228d0">get_sequence</a>(i);</div>
<div class="line">        <a class="code" href="xsample07a_8cpp.html#ac02c2935dcf3510be1130c2222f75247">generate_k_mer_bvector</a>(bv, seq_vect, k_size, k_buf);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// serialize the vector</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keyword">typename</span> <a name="_a55"></a><a class="code" href="structbm_1_1bvector_1_1statistics.html">bm::bvector&lt;&gt;::statistics</a> st;</div>
<div class="line">        bv.<a name="a56"></a><a class="code" href="classbm_1_1bvector.html#a622e6827d799a561e2f0db28f7ac19d2">optimize</a>(tb, <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;::opt_compress</a>, &amp;st);</div>
<div class="line"> </div>
<div class="line">        buf.resize(st.<a name="a57"></a><a class="code" href="structbm_1_1bv__statistics.html#acf1547fe85bf8562dde286488d567f35">max_serialize_mem</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">size_t</span> blob_size = bvs.<a name="a58"></a><a class="code" href="classbm_1_1serializer.html#af4fcd3cfdbf46e2e746a8790674ea5f9">serialize</a>(bv, &amp;buf[0], buf.size());</div>
<div class="line">        buf.resize(blob_size);</div>
<div class="line"> </div>
<div class="line">        seq_coll.<a class="code" href="classCSequenceColl.html#ae555e53331885b0093c4991dec44730d">set_buffer</a>(i, buf);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// local progress report counter is just to avoid atomic too often</span></div>
<div class="line">        ++cnt;</div>
<div class="line">        <span class="keywordflow">if</span> (cnt &gt;= 100)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="xsample07a_8cpp.html#af667eb15b7b3d2db6766614694c71546">k_mer_progress_count</a>.fetch_add(cnt);</div>
<div class="line">            cnt = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a59"></a><a class="code" href="xsample07a_8cpp.html#ae5a9b17aa2ea356fc5bf9b02cc8bac01">generate_k_mers_parallel</a>(<a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll, <span class="keywordtype">unsigned</span> k_size,</div>
<div class="line">                              <span class="keywordtype">unsigned</span> concurrency)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> total_seq_size = seq_coll.<a class="code" href="classCSequenceColl.html#a50104368c650b21bc0251d67db4da4cf">total_seq_size</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!concurrency)</div>
<div class="line">        concurrency = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> batch_size = total_seq_size / concurrency;</div>
<div class="line">    <span class="keywordflow">if</span> (!batch_size)</div>
<div class="line">        batch_size = total_seq_size;</div>
<div class="line">    std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> from = 0; from &lt;= seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>(); )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">size_t</span> to = from;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> to_pick = 0; to &lt; seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>(); ++to)</div>
<div class="line">        {</div>
<div class="line">            to_pick += seq_coll.<a class="code" href="classCSequenceColl.html#ab2e69c59e59ac6fcac55e077fc5aed05">seq_size</a>(to);</div>
<div class="line">            <span class="keywordflow">if</span> (to_pick &gt;= batch_size)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="comment">// for</span></div>
<div class="line"> </div>
<div class="line">        futures.emplace_back(</div>
<div class="line">            std::async(std::launch::async,</div>
<div class="line">            [&amp;seq_coll, k_size, from, to]() { <a class="code" href="xsample07a_8cpp.html#a215ea2e60054a2ccc30a0f8b1e8a4dfc">generate_k_mers</a>(seq_coll, k_size, from, to); }</div>
<div class="line">            ));</div>
<div class="line"> </div>
<div class="line">        from = to+1;</div>
<div class="line">    } <span class="comment">// for from</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// wait for all jobs to finish, print progress report</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> cnt = seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> c_prev = 0;</div>
<div class="line">        <span class="keywordflow">while</span>(1)</div>
<div class="line">        {</div>
<div class="line">            std::future_status status = e.wait_for(std::chrono::seconds(60));</div>
<div class="line">            <span class="keywordflow">if</span> (status == std::future_status::ready)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// progress report (entertainment)</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> c = <a class="code" href="xsample07a_8cpp.html#af667eb15b7b3d2db6766614694c71546">k_mer_progress_count</a>;</div>
<div class="line">            <span class="keyword">auto</span> delta = c - c_prev;</div>
<div class="line">            c_prev = c;</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">auto</span> remain_cnt = cnt - c;</div>
<div class="line">            <span class="keyword">auto</span> remain_min = remain_cnt / delta;</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;\r&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;: progress per minute=&quot;</span> &lt;&lt; delta;</div>
<div class="line">            <span class="keywordflow">if</span> (remain_min &lt; 120)</div>
<div class="line">            {</div>
<div class="line">                 cout &lt;&lt; <span class="stringliteral">&quot; wait for &quot;</span> &lt;&lt; remain_min &lt;&lt; <span class="stringliteral">&quot;m     &quot;</span> &lt;&lt; flush;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">auto</span> remain_h = remain_min / 60;</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot; wait for &quot;</span> &lt;&lt; remain_h &lt;&lt; <span class="stringliteral">&quot;h     &quot;</span> &lt;&lt; flush;</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">// while</span></div>
<div class="line">    } <span class="comment">// for</span></div>
<div class="line">    cout &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Group (clustrer) of sequences</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span><a name="_a60"></a><a class="code" href="classCSeqGroup.html">CSeqGroup</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a name="a61"></a><a class="code" href="classCSeqGroup.html#a4d11366bb04743841cb36fd93ebadbe5">CSeqGroup</a>(<a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> lead_id = ~0ull)</div>
<div class="line">        : m_lead_id(lead_id), m_bv_members(<a class="code" href="namespacebm.html">bm</a>::<a name="a62"></a><a class="code" href="group__bvector.html#ggad0b87b3b7292383a864d27feaf1c9effa7fe09d1d7c62a813db922c396c0cbc9c">BM_GAP</a>)</div>
<div class="line">    {</div>
<div class="line">        m_bv_members.<a name="a63"></a><a class="code" href="classbm_1_1bvector.html#a52b4259a5cc4ebd8953832c696e24f02">set</a>(lead_id);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// set id for the group representative</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a64"></a><a class="code" href="classCSeqGroup.html#a74e8e1247f72e346d73c7200d8029381">set_lead</a>(<a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> lead_id)</div>
<div class="line">        { <a name="a65"></a><a class="code" href="classCSeqGroup.html#ab14ad440236209231990885651ef88b5">add_member</a>(m_lead_id = lead_id); }<span class="comment"></span></div>
<div class="line"><span class="comment">    /// Get lead id</span></div>
<div class="line"><span class="comment"></span>    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <a name="a66"></a><a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_lead_id; }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// check is cluster is non-empty</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">bool</span> <a name="a67"></a><a class="code" href="classCSeqGroup.html#aef7c748975302832ac3f57591fab03e8">is_assigned</a>() { <span class="keywordflow">return</span> m_lead_id != ~0ull; }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// add a member to the group</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="classCSeqGroup.html#ab14ad440236209231990885651ef88b5">add_member</a>(<a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <span class="keywordtype">id</span>) { m_bv_members.<a name="a68"></a><a class="code" href="classbm_1_1bvector.html#aff4c0900eed72eaccff6f5804e33ce97">set_bit_no_check</a>(<span class="keywordtype">id</span>); }</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classCSeqGroup.html#ab14ad440236209231990885651ef88b5">add_member</a>(<a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_kmer)</div>
<div class="line">    {</div>
<div class="line">        m_bv_members.<a class="code" href="classbm_1_1bvector.html#aff4c0900eed72eaccff6f5804e33ce97">set_bit_no_check</a>(<span class="keywordtype">id</span>);</div>
<div class="line">        m_bv_kmer_union |= bv_kmer;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">void</span> <a name="a69"></a><a class="code" href="classCSeqGroup.html#a5b37e6be126e44f0deb9e8ba82a52f48">add_member_sync</a>(<a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_kmer)</div>
<div class="line">    {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; guard(mtx_add_member_lock);</div>
<div class="line">        m_bv_members.<a class="code" href="classbm_1_1bvector.html#aff4c0900eed72eaccff6f5804e33ce97">set_bit_no_check</a>(<span class="keywordtype">id</span>); <span class="comment">// a bit faster than set()</span></div>
<div class="line">        m_bv_kmer_union |= bv_kmer;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a70"></a><a class="code" href="classCSeqGroup.html#aea7eefd35468ee3e3abf6ec4baf1afc4">merge_member_sync</a>(<a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_seq, <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_kmer)</div>
<div class="line">    {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; guard(mtx_add_member_lock);</div>
<div class="line">        m_bv_members.<a name="a71"></a><a class="code" href="classbm_1_1bvector.html#a237170e9f988319665bbcac2cd10e24e">merge</a>(bv_seq);</div>
<div class="line">        m_bv_kmer_union.<a class="code" href="classbm_1_1bvector.html#a237170e9f988319665bbcac2cd10e24e">merge</a>(bv_kmer);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <a name="a72"></a><a class="code" href="classCSeqGroup.html#a46f86527c0558773febb4e032aa9dd3f">count_and_union_sync</a>(<span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv)</div>
<div class="line">    {</div>
<div class="line">        std::lock_guard&lt;std::mutex&gt; guard(mtx_add_member_lock);</div>
<div class="line">        <span class="keywordflow">return</span> <a name="a73"></a><a class="code" href="group__setalgo.html#ga5fb1131811b7b834dfc56a3874667a65">bm::count_and</a>(bv, m_bv_kmer_union);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a74"></a><a class="code" href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">clear_member</a>(<a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <span class="keywordtype">id</span>) { m_bv_members.<a class="code" href="classbm_1_1bvector.html#a52b4259a5cc4ebd8953832c696e24f02">set</a>(<span class="keywordtype">id</span>, <span class="keyword">false</span>); }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a name="a75"></a><a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>() { <span class="keywordflow">return</span> m_bv_rep; }</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_bv_rep; }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a name="a76"></a><a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_bv_members; }</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>() { <span class="keywordflow">return</span> m_bv_members; }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a name="a77"></a><a class="code" href="classCSeqGroup.html#a4cfdeb16254f1fa0954e730cf0cc068a">get_kmer_union</a>() { <span class="keywordflow">return</span> m_bv_kmer_union; }</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a class="code" href="classCSeqGroup.html#a4cfdeb16254f1fa0954e730cf0cc068a">get_kmer_union</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_bv_kmer_union; }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span><a name="_a78"></a><a class="code" href="classCSeqClusters.html">CSeqClusters</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a>    m_lead_id;       <span class="comment">///&lt; groups lead vector ID</span></div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> m_bv_members;    <span class="comment">///&lt; vector of all group member ids</span></div>
<div class="line">    std::mutex    mtx_add_member_lock; <span class="comment">///&lt; concurrency protection for add_member_sync()</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> m_bv_rep;        <span class="comment">///&lt; group&#39;s representative vector</span></div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> m_bv_kmer_union; <span class="comment">///&lt; union of all k-mers of members</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code" href="classCSeqClusters.html">CSeqClusters</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">typedef</span> std::vector&lt;std::unique_ptr&lt;CSeqGroup&gt; &gt; <a name="a79"></a><a class="code" href="classCSeqClusters.html#a8837433904136f43c03cfe1d367203df">groups_vector_type</a>;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a name="a80"></a><a class="code" href="classCSeqClusters.html#afe35ef86fc5c745c8b31c17959988576">CSeqClusters</a>()</div>
<div class="line">    {}</div>
<div class="line">    <a class="code" href="classCSeqClusters.html#afe35ef86fc5c745c8b31c17959988576">CSeqClusters</a>(<span class="keyword">const</span> <a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp;)=<span class="keyword">delete</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a81"></a><a class="code" href="classCSeqClusters.html#a81b8a45ce4451e584f3f666970520ad0">add_group</a>(<a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg) { m_seq_groups.emplace_back(sg); }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// memebers moved into their own group</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a82"></a><a class="code" href="classCSeqClusters.html#ad7dea1e2db982c9ee5e73bf43e293b55">take_group</a>(<a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_members);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Acquire all groups from another cluster collection</span></div>
<div class="line"><span class="comment">    ///</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a83"></a><a class="code" href="classCSeqClusters.html#a14b9a82707e0944cb426e757a36dbeaa">merge_from</a>(<a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp; sc);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Remove groups which turned empty after clusterization</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a84"></a><a class="code" href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">clear_empty_groups</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Compute union of all cluster group members</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a name="a85"></a><a class="code" href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">union_all_groups</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Resolve duplicate membership between groups</span></div>
<div class="line"><span class="comment">    ///</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a86"></a><a class="code" href="classCSeqClusters.html#a2771ddb955a6b7b945ff3b127bf28dd4">resolve_duplicates</a>(<span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// Find the best representatives in all cluster groups</span></div>
<div class="line"><span class="comment">    /// the criteria is maximum absolute similarity to all members</span></div>
<div class="line"><span class="comment">    ///</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a87"></a><a class="code" href="classCSeqClusters.html#a26b012c2b38e516050a0b14644c5bb10">elect_leaders</a>(<span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                       <span class="keywordtype">unsigned</span> concurrency);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// calculate avg cluster population count</span></div>
<div class="line"><span class="comment"></span>    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <a name="a88"></a><a class="code" href="classCSeqClusters.html#ad1e354314877bef0603a8cd97a3c37eb">compute_avg_count</a>() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> <a name="a89"></a><a class="code" href="classCSeqClusters.html#a2331b4d35dd7ea86a9c1fc59e31f66e0">groups_size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_seq_groups.size(); }</div>
<div class="line">    <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* <a name="a90"></a><a class="code" href="classCSeqClusters.html#a70ba5a244008b79214460b0a5d9336e2">get_group</a>(<span class="keywordtype">size_t</span> idx) { <span class="keywordflow">return</span> m_seq_groups[idx].get(); }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /// print clusterization report</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordtype">void</span> <a name="a91"></a><a class="code" href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">print_summary</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* title) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>         m_all_members; <span class="comment">///&lt; Union of all group members</span></div>
<div class="line">    <a class="code" href="classCSeqClusters.html#a8837433904136f43c03cfe1d367203df">groups_vector_type</a>    m_seq_groups; <span class="comment">///&lt; vector of all formed clusters</span></div>
<div class="line">    <a name="_a92"></a><a class="code" href="classbm_1_1aggregator.html">bm::aggregator&lt;bvector_type&gt;</a> agg; <span class="comment">///&lt; fast aggregator for set UNION ops</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">CSeqClusters::clear_empty_groups</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (groups_vector_type::iterator it = m_seq_groups.begin();</div>
<div class="line">         it != m_seq_groups.end(); )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = it-&gt;get();</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_mem = sg-&gt;<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>();</div>
<div class="line">        <span class="keyword">auto</span> cnt = bv_mem.<a name="a93"></a><a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (cnt &lt; 2) <span class="comment">// practically empty group</span></div>
<div class="line">            it = m_seq_groups.erase(it);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            ++it;</div>
<div class="line">    } <span class="comment">// for</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSeqClusters.html#ad7dea1e2db982c9ee5e73bf43e293b55">CSeqClusters::take_group</a>(<a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_members)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> lead_id = bv_members.<a name="a94"></a><a class="code" href="classbm_1_1bvector.html#a9ab6964e14405327936d183a11dcd455">get_first</a>();</div>
<div class="line">    <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = <span class="keyword">new</span> <a class="code" href="classCSeqGroup.html">CSeqGroup</a>(lead_id);</div>
<div class="line">    sg-&gt;<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>().<a name="a95"></a><a class="code" href="classbm_1_1bvector.html#a9764b5a36f4b012d1e4b4dbef4e85d0e">swap</a>(bv_members); <span class="comment">// move members to the cluster</span></div>
<div class="line">    <a class="code" href="classCSeqClusters.html#a81b8a45ce4451e584f3f666970520ad0">add_group</a>(sg);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; <a class="code" href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">CSeqClusters::union_all_groups</a>()</div>
<div class="line">{</div>
<div class="line">    agg.<a name="a96"></a><a class="code" href="classbm_1_1aggregator.html#a81093f82893bd49a84ff9064e1e40c50">set_optimization</a>();</div>
<div class="line">    m_all_members.<a name="a97"></a><a class="code" href="classbm_1_1bvector.html#ac6f13fa4ba188585e5c5d4e89843a44e">clear</a>();</div>
<div class="line">    <span class="keywordflow">for</span> (groups_vector_type::const_iterator it = m_seq_groups.begin();</div>
<div class="line">         it != m_seq_groups.end(); ++it)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = it-&gt;get();</div>
<div class="line">        agg.<a name="a98"></a><a class="code" href="classbm_1_1aggregator.html#a8ec1f6bd580be40081b0fe494ee45b02">add</a>(&amp;sg-&gt;<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>());</div>
<div class="line">    } <span class="comment">// for</span></div>
<div class="line"> </div>
<div class="line">    agg.<a name="a99"></a><a class="code" href="classbm_1_1aggregator.html#a650fc3a5385c98a7b8bc7bf188ce4487">combine_or</a>(m_all_members); <span class="comment">// run UNION of all member vectors</span></div>
<div class="line">    agg.<a name="a100"></a><a class="code" href="classbm_1_1aggregator.html#a57130ddfcf21b086c66a3cc115c2238c">reset</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> m_all_members;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> <a class="code" href="classCSeqClusters.html#ad1e354314877bef0603a8cd97a3c37eb">CSeqClusters::compute_avg_count</a>()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> cnt = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (groups_vector_type::const_iterator it = m_seq_groups.begin();</div>
<div class="line">         it != m_seq_groups.end(); ++it)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = it-&gt;get();</div>
<div class="line">        cnt += sg-&gt;<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>().<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">    }</div>
<div class="line">    cnt = cnt / m_seq_groups.size();</div>
<div class="line">    <span class="keywordflow">return</span> cnt;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSeqClusters.html#a14b9a82707e0944cb426e757a36dbeaa">CSeqClusters::merge_from</a>(<a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp; sc)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = sc.<a name="a101"></a>m_seq_groups.begin(); it != sc.m_seq_groups.end(); ++it)</div>
<div class="line">        m_seq_groups.emplace_back(it-&gt;release());</div>
<div class="line">    sc.m_seq_groups.clear();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a name="a102"></a><a class="code" href="xsample07a_8cpp.html#af1bd58563209753ca7eea0393a9dd237">resolve_duplicates</a>(<a class="code" href="classCSeqGroup.html">CSeqGroup</a>&amp; seq_group1,</div>
<div class="line">                        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>&amp; seq_group2,</div>
<div class="line">                        <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSeqClusters.html#a2771ddb955a6b7b945ff3b127bf28dd4">CSeqClusters::resolve_duplicates</a>(<span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_seq_groups.size(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg1 = m_seq_groups[i].get();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; i; ++j)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg2 = m_seq_groups[j].get();</div>
<div class="line">            <span class="comment">// resolve pairwise conflicts between cluster groups</span></div>
<div class="line">            <a class="code" href="classCSeqClusters.html#a2771ddb955a6b7b945ff3b127bf28dd4">::resolve_duplicates</a>(*sg1, *sg2, seq_coll);</div>
<div class="line">        } <span class="comment">// for j</span></div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Compute similarity distances for one row/vector (1:N) of distance matrix</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a103"></a><a class="code" href="xsample07a_8cpp.html#a6df282f999b658952c4a5423e2465d95">compute_and_sim_row</a>(</div>
<div class="line">        <span class="keywordtype">unsigned</span>* row,</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_i,</div>
<div class="line">        <span class="keywordtype">size_t</span> i,</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::unique_ptr&lt;bvector_type&gt; &gt;&amp; k_mers_vect)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> j;</div>
<div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; i; ++j)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_j = k_mers_vect[j].get();</div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> and_cnt = <a class="code" href="group__setalgo.html#ga5fb1131811b7b834dfc56a3874667a65">bm::count_and</a>(*bv_i, *bv_j);</div>
<div class="line">        row[j] = unsigned(and_cnt);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">auto</span> cnt = bv_i-&gt;<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">    row[j] = unsigned(cnt);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Compute similarity distances matrix (COUNT(AND(a, b))</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a104"></a><a class="code" href="xsample07a_8cpp.html#afb561b8a5624682616e92a027584a8d9">compute_and_sim</a>(<a class="code" href="xsample07a_8cpp.html#a86fb99116b47ce90217491648448fa46">distance_matrix_type</a>&amp; dm,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_mem,</div>
<div class="line">                     <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> bv_mem_cnt,</div>
<div class="line">                     <span class="keywordtype">unsigned</span> concurrency)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (concurrency &lt; 1)</div>
<div class="line">        concurrency = 1;</div>
<div class="line">    <span class="keyword">auto</span> N = bv_mem_cnt;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> k_max_electors = 500;</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_sub; <span class="comment">// subset vector</span></div>
<div class="line">    <span class="keywordflow">if</span> (N &gt; k_max_electors) <span class="comment">// TODO: parameterize the</span></div>
<div class="line">    {</div>
<div class="line">        <a name="_a105"></a><a class="code" href="classbm_1_1random__subset.html">bm::random_subset&lt;bm::bvector&lt;&gt;</a> &gt; rsub;</div>
<div class="line">        rsub.<a name="a106"></a><a class="code" href="classbm_1_1random__subset.html#abdf1e716e124ff4d7ad8ccef1646c99e">sample</a>(bv_sub, bv_mem, k_max_electors); <span class="comment">// pick random sunset</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a> k_mers_vect;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// materialize list of vectors used in distance calculation</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    seq_coll.<a class="code" href="classCSequenceColl.html#a4fcafecf4680670641820eb42d8d38fe">deserialize_k_mers</a>(k_mers_vect, bv_mem, N);</div>
<div class="line"> </div>
<div class="line">    std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line">    <span class="keywordtype">unsigned</span> parallel_cnt = 0; <span class="comment">// number of jobs in flight at a time</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> i;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; N; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_i = k_mers_vect[i].get();</div>
<div class="line">        <span class="keywordtype">unsigned</span>* row = dm.row(i);</div>
<div class="line">        <span class="keywordflow">do</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (parallel_cnt &lt; concurrency)</div>
<div class="line">            {</div>
<div class="line">                futures.emplace_back(</div>
<div class="line">                    std::async(std::launch::async,</div>
<div class="line">                    [row, bv_i, i, &amp;k_mers_vect]()</div>
<div class="line">                        { <a class="code" href="xsample07a_8cpp.html#a6df282f999b658952c4a5423e2465d95">compute_and_sim_row</a>(row, bv_i, i, k_mers_vect); }</div>
<div class="line">                    ));</div>
<div class="line">                ++parallel_cnt;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// wait for an async() slot to open (overbooking control)</span></div>
<div class="line">                <a class="code" href="xsample07a_8cpp.html#a375552213e6e0f946f44c3c19520df7f">::wait_for_slot</a>(futures, &amp;parallel_cnt, concurrency);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">while</span>(1);</div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// sync point</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures)</div>
<div class="line">        e.wait();</div>
<div class="line"> </div>
<div class="line">    dm.replicate_triange(); <span class="comment">// copy to full simetrical distances from triangle</span></div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Compute union (Universe) of all k-mers in the cluster group</span></div>
<div class="line"><span class="comment">/// Implemented as a OR of all k-mer fingerprints</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a107"></a><a class="code" href="xsample07a_8cpp.html#aedd910426139ee0f1e66a713aa8e0ff2">compute_seq_group_union</a>(<a class="code" href="classCSeqGroup.html">CSeqGroup</a>&amp;           seq_group,</div>
<div class="line">                             <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a>(tb)</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_kmer_union = seq_group.<a class="code" href="classCSeqGroup.html#a4cfdeb16254f1fa0954e730cf0cc068a">get_kmer_union</a>();</div>
<div class="line">    bv_kmer_union.<a class="code" href="classbm_1_1bvector.html#ac6f13fa4ba188585e5c5d4e89843a44e">clear</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_all_members = seq_group.<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>();</div>
<div class="line">    <span class="keywordflow">for</span>(<a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en(bv_all_members) ;en.<a name="a108"></a><a class="code" href="classbm_1_1bvector_1_1iterator__base.html#a3f6af7f5b46c0219b28916187d302c43">valid</a>(); ++en)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> idx = *en;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(idx);</div>
<div class="line">        <span class="keywordflow">if</span> (!buf)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a>(bv_kmer_union, buf, tb); <span class="comment">// deserialize is an OR operation</span></div>
<div class="line">    } <span class="comment">// for en</span></div>
<div class="line">    bv_kmer_union.<a class="code" href="classbm_1_1bvector.html#a622e6827d799a561e2f0db28f7ac19d2">optimize</a>(tb);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSeqClusters.html#a26b012c2b38e516050a0b14644c5bb10">CSeqClusters::elect_leaders</a>(<span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                                 <span class="keywordtype">unsigned</span> concurrency)</div>
<div class="line">{</div>
<div class="line">    <a name="_a109"></a><a class="code" href="classbm_1_1operation__deserializer.html">bm::operation_deserializer&lt;bm::bvector&lt;&gt;</a> &gt; od;</div>
<div class="line">    <a class="code" href="classbm_1_1random__subset.html">bm::random_subset&lt;bm::bvector&lt;&gt;</a> &gt; rsub;</div>
<div class="line"> </div>
<div class="line">    std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; m_seq_groups.size(); ++k)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = m_seq_groups[k].get();</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_all_members = sg-&gt;<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>();</div>
<div class="line">        bv_all_members.<a class="code" href="classbm_1_1bvector.html#a52b4259a5cc4ebd8953832c696e24f02">set</a>(sg-&gt;<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>());</div>
<div class="line">        <span class="keyword">auto</span> N = bv_all_members.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">        <span class="keyword">auto</span> all_members_count = N; (void) all_members_count;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// determine the size of the &quot;electoral colledge&quot; on available concurrency</span></div>
<div class="line">        <span class="keywordtype">unsigned</span> k_max_electors = 200 * unsigned(log2(concurrency));</div>
<div class="line">        <span class="keywordflow">if</span> (k_max_electors &lt; 500)</div>
<div class="line">            k_max_electors = 500;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_mem = &amp;bv_all_members; <span class="comment">// vector of electors</span></div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_sub; <span class="comment">// subset vector</span></div>
<div class="line">        <span class="keywordflow">if</span> (N &gt; k_max_electors) <span class="comment">// TODO: parameterize the</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// pick a random sub-set as the &quot;electoral colledge&quot;</span></div>
<div class="line">            rsub.<a class="code" href="classbm_1_1random__subset.html#abdf1e716e124ff4d7ad8ccef1646c99e">sample</a>(bv_sub, bv_all_members, k_max_electors);</div>
<div class="line">            bv_sub.<a class="code" href="classbm_1_1bvector.html#a52b4259a5cc4ebd8953832c696e24f02">set</a>(sg-&gt;<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>()); <span class="comment">// current leader always takes part</span></div>
<div class="line">            bv_mem = &amp;bv_sub;</div>
<div class="line">            N = bv_sub.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// NxN distance matrix between members</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="xsample07a_8cpp.html#a86fb99116b47ce90217491648448fa46">distance_matrix_type</a> dm(N, N);</div>
<div class="line">        dm.init();</div>
<div class="line">        dm.set_zero();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// compute triangular distance matrix</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="xsample07a_8cpp.html#afb561b8a5624682616e92a027584a8d9">compute_and_sim</a>(dm, seq_coll, *bv_mem, N, concurrency);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// leader election based on maximum similarity to other cluster</span></div>
<div class="line">        <span class="comment">// elements</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> best_score = 0;</div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> leader_idx = sg-&gt;<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>();</div>
<div class="line">        assert(bv_mem-&gt;<a name="a110"></a><a class="code" href="classbm_1_1bvector.html#a16d902c3df4aa6aa88d8e137af4a4b9b">test</a>(leader_idx));</div>
<div class="line">        <span class="keyword">auto</span> rank = bv_mem-&gt;<a name="a111"></a><a class="code" href="classbm_1_1bvector.html#a99395aaa8ab689455054bda9b261de60">count_range</a>(0, leader_idx);</div>
<div class="line">        assert(rank);</div>
<div class="line">        dm.sum(best_score, rank-1);  <span class="comment">// use sum or all similarities as a score for the leader</span></div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> old_leader_idx = leader_idx;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en(bv_mem-&gt;<a class="code" href="classbm_1_1bvector.html#a86b939f3aed555dc073e8c26e9efea71">first</a>());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; en.valid(); ++en, ++i)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> cand_score;</div>
<div class="line">            dm.sum(cand_score, i);  <span class="comment">// use sum or all similarities as a score</span></div>
<div class="line">            <span class="keywordflow">if</span> (cand_score &gt; best_score) <span class="comment">// better candidate for a leader</span></div>
<div class="line">            {</div>
<div class="line">                best_score = cand_score;</div>
<div class="line">                leader_idx = *en;</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">// for en</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (leader_idx != old_leader_idx) <span class="comment">// found a new leader</span></div>
<div class="line">        {</div>
<div class="line">            sg-&gt;<a class="code" href="classCSeqGroup.html#a74e8e1247f72e346d73c7200d8029381">set_lead</a>(leader_idx);</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(leader_idx);</div>
<div class="line">            assert(buf);</div>
<div class="line">            <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv = &amp;sg-&gt;<a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>();</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// async replace the leader representative k-mer vector</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            futures.emplace_back(</div>
<div class="line">                std::async(std::launch::async,</div>
<div class="line">                [bv, buf]() { bv-&gt;<a class="code" href="classbm_1_1bvector.html#ac6f13fa4ba188585e5c5d4e89843a44e">clear</a>(); <a class="code" href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a>(*bv, buf); }</div>
<div class="line">                ));</div>
<div class="line">            <span class="comment">// re-compute k-mer UNION of all vectors</span></div>
<div class="line">            futures.emplace_back(</div>
<div class="line">                std::async(std::launch::async,</div>
<div class="line">                [sg, &amp;seq_coll]() { <a class="code" href="xsample07a_8cpp.html#aedd910426139ee0f1e66a713aa8e0ff2">compute_seq_group_union</a>(*sg, seq_coll); }</div>
<div class="line">                ));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures) <span class="comment">// wait for all forked tasks</span></div>
<div class="line">        e.wait();</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">CSeqClusters::print_summary</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* title)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    cout &lt;&lt; title &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_seq_groups.size(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = m_seq_groups[i].get();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_mem = sg-&gt;<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>();</div>
<div class="line">        cout &lt;&lt; sg-&gt;<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">             &lt;&lt; bv_mem.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>() &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;-----------\nTotal: &quot;</span> &lt;&lt;  m_seq_groups.size() &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a112"></a><a class="code" href="xsample07a_8cpp.html#a9a7564431a6efa1c032b22070d822a3b">compute_group</a>(<a class="code" href="classCSeqGroup.html">CSeqGroup</a>&amp; seq_group,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                   <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_exceptions,</div>
<div class="line">                   <span class="keywordtype">float</span> similarity_cut_off)</div>
<div class="line">{</div>
<div class="line">    assert(similarity_cut_off &lt; 1);</div>
<div class="line">    assert(seq_group.<a class="code" href="classCSeqGroup.html#aef7c748975302832ac3f57591fab03e8">is_assigned</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> sz = seq_coll.<a class="code" href="classCSequenceColl.html#aad175e6424b73bda2f736b5dd30d43d1">buf_size</a>();</div>
<div class="line">    <span class="keywordtype">size_t</span> lead_id = seq_group.<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (lead_id &gt;= sz)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(lead_id);</div>
<div class="line">    <span class="keywordflow">if</span> (!buf)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv = seq_group.<a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>();</div>
<div class="line">    <a class="code" href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a>(bv, buf);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> i_cnt = bv.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">    <span class="comment">// approximate number of k-mers we consider similar</span></div>
<div class="line">    <span class="keywordtype">float</span> similarity_target = float(i_cnt * <span class="keywordtype">float</span>(similarity_cut_off));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1operation__deserializer.html">bm::operation_deserializer&lt;bm::bvector&lt;&gt;</a> &gt; od;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sz; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span> is_except = bv_exceptions.<a class="code" href="classbm_1_1bvector.html#a16d902c3df4aa6aa88d8e137af4a4b9b">test</a>(i);</div>
<div class="line">        <span class="keywordflow">if</span> (is_except)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(i);</div>
<div class="line">        <span class="keywordflow">if</span> (!buf)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        <span class="comment">// constant deserializer AND just to count the product</span></div>
<div class="line">        <span class="comment">// without actual deserialization (from the compressed BLOB)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> and_cnt = od.<a name="a113"></a><a class="code" href="classbm_1_1operation__deserializer.html#a67b82bd495cfa83a2d528a739b6d2cb7">deserialize</a>(bv, buf, 0, <a name="a114"></a><a class="code" href="group__bvector.html#gga76b70d2b9182a6dcac151d1bd9ec6109a378be4b14cee6a341e859fd3157ab959">bm::set_COUNT_AND</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (and_cnt &amp;&amp; (<span class="keywordtype">float</span>(and_cnt) &gt; similarity_target)) <span class="comment">// similar enough to be a candidate</span></div>
<div class="line">        {</div>
<div class="line">            seq_group.<a class="code" href="classCSeqGroup.html#ab14ad440236209231990885651ef88b5">add_member</a>(i);</div>
<div class="line">            found = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="comment">// for i</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!found)</div>
<div class="line">        seq_group.<a class="code" href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">clear_member</a>(lead_id);</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Resolve duplicate members between two groups</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="xsample07a_8cpp.html#af1bd58563209753ca7eea0393a9dd237">resolve_duplicates</a>(<a class="code" href="classCSeqGroup.html">CSeqGroup</a>&amp; seq_group1,</div>
<div class="line">                        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>&amp; seq_group2,</div>
<div class="line">                        <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (&amp;seq_group1 == &amp; seq_group2) <span class="comment">// self check</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv1 = seq_group1.<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>();</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv2 = seq_group2.<a class="code" href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">get_members</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// build intersect between group members</span></div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_and;</div>
<div class="line">    bv_and.<a name="a115"></a><a class="code" href="classbm_1_1bvector.html#a37c1ccb4755c61450311918ad3330aa6">bit_and</a>(bv1, bv2, <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;::opt_none</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (bv_and.<a name="a116"></a><a class="code" href="classbm_1_1bvector.html#a69729bae3fca407ff1228cf2db761adb">any</a>()) <span class="comment">// double membership detected</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_rep1 = seq_group1.<a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>();</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_rep2 = seq_group2.<a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classbm_1_1operation__deserializer.html">bm::operation_deserializer&lt;bm::bvector&lt;&gt;</a> &gt; od;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// evaluate each double member for best membership placement</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en(bv_and); en.<a class="code" href="classbm_1_1bvector_1_1iterator__base.html#a3f6af7f5b46c0219b28916187d302c43">valid</a>(); ++en)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> idx = *en;</div>
<div class="line">            <span class="keyword">auto</span> lead_idx1 = seq_group1.<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>();</div>
<div class="line">            <span class="keyword">auto</span> lead_idx2 = seq_group2.<a class="code" href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">get_lead</a>();</div>
<div class="line">            assert(lead_idx1 != lead_idx2);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (idx == lead_idx1)</div>
<div class="line">            {</div>
<div class="line">                seq_group2.<a class="code" href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">clear_member</a>(idx);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (idx == lead_idx2)</div>
<div class="line">            {</div>
<div class="line">                seq_group1.<a class="code" href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">clear_member</a>(idx);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(idx);</div>
<div class="line">            assert(buf);</div>
<div class="line">            <span class="comment">// resolve conflict based on max.absolute similarity</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> and_cnt1 = od.<a class="code" href="classbm_1_1operation__deserializer.html#a67b82bd495cfa83a2d528a739b6d2cb7">deserialize</a>(bv_rep1, buf, 0, <a class="code" href="group__bvector.html#gga76b70d2b9182a6dcac151d1bd9ec6109a378be4b14cee6a341e859fd3157ab959">bm::set_COUNT_AND</a>);</div>
<div class="line">            <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> and_cnt2 = od.<a class="code" href="classbm_1_1operation__deserializer.html#a67b82bd495cfa83a2d528a739b6d2cb7">deserialize</a>(bv_rep2, buf, 0, <a class="code" href="group__bvector.html#gga76b70d2b9182a6dcac151d1bd9ec6109a378be4b14cee6a341e859fd3157ab959">bm::set_COUNT_AND</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (and_cnt1 &gt;= and_cnt2)</div>
<div class="line">                seq_group2.<a class="code" href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">clear_member</a>(idx);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                seq_group1.<a class="code" href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">clear_member</a>(idx);</div>
<div class="line"> </div>
<div class="line">        } <span class="comment">// for</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Utility class to accumulate cahnges to cluster</span></div>
<div class="line"><span class="comment">/// before commiting it (mutex syncronous operation)</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">struct </span><a name="_a117"></a><a class="code" href="structCKMerAcc.html">CKMerAcc</a></div>
<div class="line">{</div>
<div class="line">    <a name="a118"></a><a class="code" href="structCKMerAcc.html#af11d3fa42f54b623011cad947bf3bd2e">CKMerAcc</a>(<span class="keywordtype">size_t</span> sz)</div>
<div class="line">    : <a name="a119"></a><a class="code" href="structCKMerAcc.html#a91803d7e1b28660a20bc6a88ca9b2656">bv_members</a>(sz), <a name="a120"></a><a class="code" href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">bv_kmers</a>(sz)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a121"></a><a class="code" href="structCKMerAcc.html#a3dc2baa2e6a20c61a684a29901df538f">add</a>(<span class="keywordtype">size_t</span> cluster_id,</div>
<div class="line">             <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> m_id, <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_kmer)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_m = <a class="code" href="structCKMerAcc.html#a91803d7e1b28660a20bc6a88ca9b2656">bv_members</a>[cluster_id].get();</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_k = <a class="code" href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">bv_kmers</a>[cluster_id].get();</div>
<div class="line">        <span class="keywordflow">if</span> (!bv_m)</div>
<div class="line">        {</div>
<div class="line">            assert(!<a class="code" href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">bv_kmers</a>[cluster_id].get());</div>
<div class="line">            <a class="code" href="structCKMerAcc.html#a91803d7e1b28660a20bc6a88ca9b2656">bv_members</a>[cluster_id].reset(<span class="keyword">new</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>(<a class="code" href="group__bvector.html#ggad0b87b3b7292383a864d27feaf1c9effa7fe09d1d7c62a813db922c396c0cbc9c">bm::BM_GAP</a>));</div>
<div class="line">            <a class="code" href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">bv_kmers</a>[cluster_id].reset(<span class="keyword">new</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>(<a class="code" href="group__bvector.html#ggad0b87b3b7292383a864d27feaf1c9effa7fe09d1d7c62a813db922c396c0cbc9c">bm::BM_GAP</a>));</div>
<div class="line">            bv_m = <a class="code" href="structCKMerAcc.html#a91803d7e1b28660a20bc6a88ca9b2656">bv_members</a>[cluster_id].get();</div>
<div class="line">            bv_k = <a class="code" href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">bv_kmers</a>[cluster_id].get();</div>
<div class="line">        }</div>
<div class="line">        bv_m-&gt;<a class="code" href="classbm_1_1bvector.html#a52b4259a5cc4ebd8953832c696e24f02">set</a>(m_id);</div>
<div class="line">        bv_k-&gt;<a class="code" href="classbm_1_1bvector.html#a237170e9f988319665bbcac2cd10e24e">merge</a>(bv_kmer);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a> <a class="code" href="structCKMerAcc.html#a91803d7e1b28660a20bc6a88ca9b2656">bv_members</a>;</div>
<div class="line">    <a class="code" href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a> <a class="code" href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">bv_kmers</a>;</div>
<div class="line">};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Compute AND similarity to all available clusters assign to the most similar</span></div>
<div class="line"><span class="comment">/// using cluster representative</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a122"></a><a class="code" href="xsample07a_8cpp.html#a04974186e38ba1fa8512639ebc3987bf">assign_to_best_cluster</a>(<a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp; cluster_groups,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_seq_ids,</div>
<div class="line">                            <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> seq_id_from,</div>
<div class="line">                            <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> seq_id_to)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a>(tb)</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html#a2c8990a2147fdc3e6094011e77e559e8">bm::bvector&lt;&gt;::allocator_pool_type</a> pool;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="structCKMerAcc.html">CKMerAcc</a> acc(cluster_groups.<a class="code" href="classCSeqClusters.html#a2331b4d35dd7ea86a9c1fc59e31f66e0">groups_size</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en(bv_seq_ids);</div>
<div class="line">    en.go_to(seq_id_from);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( ;en.valid(); ++en)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> seq_id = *en;</div>
<div class="line">        <span class="keywordflow">if</span> (seq_id &gt; seq_id_to)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(seq_id);</div>
<div class="line">        <span class="keywordflow">if</span> (!buf)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_k_mer;</div>
<div class="line">        bv_k_mer.<a name="a123"></a><a class="code" href="classbm_1_1bvector.html#a5caf8104ebf999f36fc1f812aaff0bd5">set_allocator_pool</a>(&amp;pool); <span class="comment">// for faster memory recycling</span></div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a>(bv_k_mer, buf, tb);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> best_score(0);</div>
<div class="line">        <span class="keywordtype">size_t</span> cluster_idx(~0ull);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// analyse candidate&#39;s similarity to all clusters via representative</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; cluster_groups.<a class="code" href="classCSeqClusters.html#a2331b4d35dd7ea86a9c1fc59e31f66e0">groups_size</a>(); ++i)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = cluster_groups.<a class="code" href="classCSeqClusters.html#a70ba5a244008b79214460b0a5d9336e2">get_group</a>(i);</div>
<div class="line">            <span class="comment">//  - COUNT(AND) similarity to the representative of each cluster</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_rep_k_mer = sg-&gt;<a class="code" href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">get_rep</a>();</div>
<div class="line">            <span class="keyword">auto</span> rep_and_cnt = <a class="code" href="group__setalgo.html#ga5fb1131811b7b834dfc56a3874667a65">bm::count_and</a>(bv_k_mer, bv_rep_k_mer);</div>
<div class="line">            <span class="keywordflow">if</span> (rep_and_cnt &gt; best_score)</div>
<div class="line">            {</div>
<div class="line">                cluster_idx = i; best_score = rep_and_cnt;</div>
<div class="line">            }</div>
<div class="line">        } <span class="comment">// for i</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cluster_idx != ~0ull) <span class="comment">// cluster association via representative</span></div>
<div class="line">        {</div>
<div class="line">            acc.add(cluster_idx, seq_id, bv_k_mer);</div>
<div class="line">        }</div>
<div class="line">    } <span class="comment">// for all seq-ids in the range</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// merge all accumulated cluster assignmnets all at once</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; cluster_groups.<a class="code" href="classCSeqClusters.html#a2331b4d35dd7ea86a9c1fc59e31f66e0">groups_size</a>(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_m = acc.bv_members[i].get();</div>
<div class="line">        <span class="keywordflow">if</span> (!bv_m)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>* bv_k = acc.bv_kmers[i].get();</div>
<div class="line">        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = cluster_groups.<a class="code" href="classCSeqClusters.html#a70ba5a244008b79214460b0a5d9336e2">get_group</a>(i);</div>
<div class="line">        sg-&gt;<a class="code" href="classCSeqGroup.html#aea7eefd35468ee3e3abf6ec4baf1afc4">merge_member_sync</a>(*bv_m, *bv_k);</div>
<div class="line">    } <span class="comment">// for</span></div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Compute AND similarity to all available clusters assign to the most similar</span></div>
<div class="line"><span class="comment">/// using UNION of k-mers in the cluster</span></div>
<div class="line"><span class="comment">/// This is a more relaxed assignmnet, used when representative does not work</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a124"></a><a class="code" href="xsample07a_8cpp.html#accc3eb1888423e72339c37675136fa5f">assign_to_best_cluster_union</a>(<a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp; cluster_groups,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                            <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_seq_ids,</div>
<div class="line">                            <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> seq_id_from,</div>
<div class="line">                            <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> seq_id_to)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a>(tb)</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html#a2c8990a2147fdc3e6094011e77e559e8">bm::bvector&lt;&gt;::allocator_pool_type</a> pool;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en(bv_seq_ids);</div>
<div class="line">    en.go_to(seq_id_from);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( ;en.valid(); ++en)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> seq_id = *en;</div>
<div class="line">        <span class="keywordflow">if</span> (seq_id &gt; seq_id_to)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf = seq_coll.<a class="code" href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">get_buf</a>(seq_id);</div>
<div class="line">        <span class="keywordflow">if</span> (!buf)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_k_mer;</div>
<div class="line">        bv_k_mer.<a class="code" href="classbm_1_1bvector.html#a5caf8104ebf999f36fc1f812aaff0bd5">set_allocator_pool</a>(&amp;pool); <span class="comment">// for faster memory recycling</span></div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a>(bv_k_mer, buf, tb);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> best_score(0);</div>
<div class="line">        <span class="keywordtype">size_t</span> cluster_idx(~0ull);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// try to extend search using UNION of all cluster k-mers</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            best_score = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; cluster_groups.<a class="code" href="classCSeqClusters.html#a2331b4d35dd7ea86a9c1fc59e31f66e0">groups_size</a>(); ++i)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = cluster_groups.<a class="code" href="classCSeqClusters.html#a70ba5a244008b79214460b0a5d9336e2">get_group</a>(i);</div>
<div class="line">                <span class="comment">//  - COUNT(AND) similarity to the representative of each cluster</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> uni_and_cnt = sg-&gt;<a class="code" href="classCSeqGroup.html#a46f86527c0558773febb4e032aa9dd3f">count_and_union_sync</a>(bv_k_mer);</div>
<div class="line">                <span class="keywordflow">if</span> (uni_and_cnt &gt; best_score)</div>
<div class="line">                {</div>
<div class="line">                    cluster_idx = i; best_score = uni_and_cnt;</div>
<div class="line">                }</div>
<div class="line">            } <span class="comment">// for i</span></div>
<div class="line">            <span class="keywordflow">if</span> (cluster_idx != ~0ull) <span class="comment">// cluster association via representative</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = cluster_groups.<a class="code" href="classCSeqClusters.html#a70ba5a244008b79214460b0a5d9336e2">get_group</a>(cluster_idx);</div>
<div class="line">                sg-&gt;<a class="code" href="classCSeqGroup.html#a5b37e6be126e44f0deb9e8ba82a52f48">add_member_sync</a>(seq_id, bv_k_mer);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="comment">// for all seq-ids in the range</span></div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Pick random sequences as cluster seed elements, try attach</span></div>
<div class="line"><span class="comment">/// initial sequences based on weighted similarity measure</span></div>
<div class="line"><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a125"></a><a class="code" href="xsample07a_8cpp.html#a2217aa988f24f927c4da2f9057b80f5e">compute_random_clusters</a>(<a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp; cluster_groups,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_total,</div>
<div class="line">                              <a class="code" href="classbm_1_1random__subset.html">bm::random_subset&lt;bvector_type&gt;</a>&amp; rsub,</div>
<div class="line">                              <span class="keywordtype">unsigned</span> num_clust,</div>
<div class="line">                              <span class="keywordtype">float</span> similarity_cut_off,</div>
<div class="line">                              <span class="keywordtype">unsigned</span> concurrency)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_rsub; <span class="comment">// random subset of sequences</span></div>
<div class="line">    rsub.<a class="code" href="classbm_1_1random__subset.html#abdf1e716e124ff4d7ad8ccef1646c99e">sample</a>(bv_rsub, bv_total, num_clust); <span class="comment">// pick random sequences as seeds</span></div>
<div class="line"> </div>
<div class="line">    std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line">    <span class="keywordtype">unsigned</span> parallel_cnt = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code" href="classbm_1_1bvector_1_1enumerator.html">bm::bvector&lt;&gt;::enumerator</a> en=bv_rsub.<a class="code" href="classbm_1_1bvector.html#a86b939f3aed555dc073e8c26e9efea71">first</a>(); en.<a class="code" href="classbm_1_1bvector_1_1iterator__base.html#a3f6af7f5b46c0219b28916187d302c43">valid</a>(); ++en)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> idx = *en;</div>
<div class="line">        <a class="code" href="classCSeqGroup.html">CSeqGroup</a>* sg = <span class="keyword">new</span> <a class="code" href="classCSeqGroup.html">CSeqGroup</a>(idx);</div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a81b8a45ce4451e584f3f666970520ad0">add_group</a>(sg);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">do</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (parallel_cnt &lt; concurrency)</div>
<div class="line">            {</div>
<div class="line">                futures.emplace_back(</div>
<div class="line">                    std::async(std::launch::async,</div>
<div class="line">                    [&amp;seq_coll, sg, &amp;bv_rsub, similarity_cut_off]()</div>
<div class="line">                        { <a class="code" href="xsample07a_8cpp.html#a9a7564431a6efa1c032b22070d822a3b">compute_group</a>(*sg, seq_coll, bv_rsub, similarity_cut_off); }</div>
<div class="line">                    ));</div>
<div class="line">                ++parallel_cnt;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// wait for an async() slot to open</span></div>
<div class="line">                <a class="code" href="xsample07a_8cpp.html#a375552213e6e0f946f44c3c19520df7f">::wait_for_slot</a>(futures, &amp;parallel_cnt, concurrency);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">while</span>(1);</div>
<div class="line">    } <span class="comment">// for en</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// wait for completion of initial cluster group formation</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures)</div>
<div class="line">        e.wait();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span> <a name="a126"></a><a class="code" href="xsample07a_8cpp.html#a006c0e66a9c90feb7d1d66f02908678d">compute_jaccard_clusters</a>(<a class="code" href="classCSeqClusters.html">CSeqClusters</a>&amp; seq_clusters,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classCSequenceColl.html">CSequenceColl</a>&amp; seq_coll,</div>
<div class="line">                              <span class="keywordtype">unsigned</span> num_clust,</div>
<div class="line">                              <span class="keywordtype">float</span> similarity_cut_off,</div>
<div class="line">                              <span class="keywordtype">unsigned</span> concurrency)</div>
<div class="line">{</div>
<div class="line">    assert(similarity_cut_off &lt; 1);</div>
<div class="line">    <span class="keywordflow">if</span> (!seq_coll.<a class="code" href="classCSequenceColl.html#aad175e6424b73bda2f736b5dd30d43d1">buf_size</a>())</div>
<div class="line">        <span class="keywordflow">return</span>; <span class="comment">// nothing to do</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1random__subset.html">bm::random_subset&lt;bm::bvector&lt;&gt;</a> &gt; rsub; <span class="comment">// sub-set getter</span></div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a> bv_total;</div>
<div class="line">    bv_total.<a name="a127"></a><a class="code" href="classbm_1_1bvector.html#aafb2ecaa1a55856533e6b4afbf788eae">set_range</a>(0, seq_coll.<a class="code" href="classCSequenceColl.html#aad175e6424b73bda2f736b5dd30d43d1">buf_size</a>());</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> rcount = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> max_pass = 3;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> pass = 0; pass &lt; max_pass; ++pass)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classCSeqClusters.html">CSeqClusters</a> cluster_groups;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="xsample07a_8cpp.html#a2217aa988f24f927c4da2f9057b80f5e">compute_random_clusters</a>(cluster_groups, seq_coll, bv_total, rsub,</div>
<div class="line">                                num_clust, similarity_cut_off, concurrency);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// remove possible empty clusters (inital seeds were picked at random)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">clear_empty_groups</a>();</div>
<div class="line"> </div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a2771ddb955a6b7b945ff3b127bf28dd4">resolve_duplicates</a>(seq_coll);</div>
<div class="line"> </div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">clear_empty_groups</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// print summary after the initial formation of cluster groups</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">print_summary</a>(<span class="stringliteral">&quot;Inital cluster formations:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// re-elect representatives</span></div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a26b012c2b38e516050a0b14644c5bb10">elect_leaders</a>(seq_coll, concurrency);</div>
<div class="line"> </div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">print_summary</a>(<span class="stringliteral">&quot;After lead re-election:&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// sub-set of sequence ids already distributed into clusters</span></div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> total_count = bv_total.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">        {</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot; total = &quot;</span> &lt;&lt; total_count &lt;&lt; endl;</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_clust = cluster_groups.<a class="code" href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">union_all_groups</a>();</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot; clustered = &quot;</span> &lt;&lt; bv_clust.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>() &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">            bv_total -= bv_clust; <span class="comment">// exlude all already clustered</span></div>
<div class="line">            total_count = bv_total.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot; remain = &quot;</span> &lt;&lt; total_count &lt;&lt; endl;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!total_count)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// run split algorithm to determine approximately equal ranges</span></div>
<div class="line">        <span class="comment">// for parallel processing</span></div>
<div class="line">        <a class="code" href="sample24_8cpp.html#a7abca04faa4bc9e482801161aed87e64">bv_ranges_vector</a> pair_vect;</div>
<div class="line">        <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> split_rank = total_count / concurrency; <span class="comment">// target population count per job</span></div>
<div class="line">        <a name="a128"></a><a class="code" href="group__setalgo.html#ga0ccd47207b6838dd6b7f97c285ebdb15">bm::rank_range_split</a>(bv_total, split_rank, pair_vect);</div>
<div class="line">        assert(pair_vect.size());</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; pair_vect.size(); ++k)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> seq_id_from = pair_vect[k].<a class="code" href="classbm_1_1bvector.html#a86b939f3aed555dc073e8c26e9efea71">first</a>;</div>
<div class="line">            <span class="keyword">auto</span> seq_id_to = pair_vect[k].second;</div>
<div class="line">            futures.emplace_back(</div>
<div class="line">                std::async(std::launch::async,</div>
<div class="line">                [&amp;cluster_groups, &amp;seq_coll, &amp;bv_total, seq_id_from, seq_id_to]()</div>
<div class="line">                    { <a class="code" href="xsample07a_8cpp.html#a04974186e38ba1fa8512639ebc3987bf">assign_to_best_cluster</a>(cluster_groups, seq_coll, bv_total, seq_id_from, seq_id_to); }</div>
<div class="line">                ));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures) <span class="comment">// sync point</span></div>
<div class="line">            e.wait();</div>
<div class="line"> </div>
<div class="line">        cluster_groups.<a class="code" href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">print_summary</a>(<span class="stringliteral">&quot;Clusters after phase 2 recruitment&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// check if there are sequences not yet belonging to any cluster</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_clust = cluster_groups.<a class="code" href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">union_all_groups</a>();</div>
<div class="line">            bv_total -= bv_clust; <span class="comment">// exlude all already clustered</span></div>
<div class="line">            rcount = bv_total.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">            <span class="keywordflow">if</span> (rcount)</div>
<div class="line">            {</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;Undistributed sequences = &quot;</span> &lt;&lt; rcount &lt;&lt; endl;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                seq_clusters.<a class="code" href="classCSeqClusters.html#a14b9a82707e0944cb426e757a36dbeaa">merge_from</a>(cluster_groups);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        seq_clusters.<a class="code" href="classCSeqClusters.html#a14b9a82707e0944cb426e757a36dbeaa">merge_from</a>(cluster_groups);</div>
<div class="line">        <a class="code" href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a> avg_group_count = seq_clusters.<a class="code" href="classCSeqClusters.html#ad1e354314877bef0603a8cd97a3c37eb">compute_avg_count</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (rcount &lt; avg_group_count) <span class="comment">// not worth another pass ?</span></div>
<div class="line">        {</div>
<div class="line">            seq_clusters.<a class="code" href="classCSeqClusters.html#ad7dea1e2db982c9ee5e73bf43e293b55">take_group</a>(bv_total);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;PASS=&quot;</span> &lt;&lt; (pass+1) &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line">    } <span class="comment">// for pass</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// try to assign to the global pool of clusters using UNION</span></div>
<div class="line">    <span class="comment">// which relaxes assignmnet</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rcount)</div>
<div class="line">    {</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_clust = seq_clusters.<a class="code" href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">union_all_groups</a>();</div>
<div class="line">            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot; clustered = &quot;</span> &lt;&lt; bv_clust.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>() &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">            bv_total -= bv_clust; <span class="comment">// exlude all already clustered</span></div>
<div class="line">            rcount = bv_total.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot; remain = &quot;</span> &lt;&lt; rcount &lt;&lt; endl;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (rcount)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="sample24_8cpp.html#a7abca04faa4bc9e482801161aed87e64">bv_ranges_vector</a> pair_vect;</div>
<div class="line">            <a class="code" href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector&lt;&gt;::size_type</a> split_rank = rcount / concurrency;</div>
<div class="line">            <a class="code" href="group__setalgo.html#ga0ccd47207b6838dd6b7f97c285ebdb15">bm::rank_range_split</a>(bv_total, split_rank, pair_vect);</div>
<div class="line"> </div>
<div class="line">            std::list&lt;std::future&lt;void&gt; &gt; futures;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; pair_vect.size(); ++k)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">auto</span> seq_id_from = pair_vect[k].<a class="code" href="classbm_1_1bvector.html#a86b939f3aed555dc073e8c26e9efea71">first</a>;</div>
<div class="line">                <span class="keyword">auto</span> seq_id_to = pair_vect[k].second;</div>
<div class="line">                futures.emplace_back(</div>
<div class="line">                    std::async(std::launch::async,</div>
<div class="line">                    [&amp;seq_clusters, &amp;seq_coll, &amp;bv_total, seq_id_from, seq_id_to]()</div>
<div class="line">                        { <a class="code" href="xsample07a_8cpp.html#accc3eb1888423e72339c37675136fa5f">assign_to_best_cluster_union</a>(seq_clusters, seq_coll, bv_total, seq_id_from, seq_id_to); }</div>
<div class="line">                    ));</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; e : futures) <span class="comment">// sync point</span></div>
<div class="line">                e.wait();</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="classbm_1_1bvector.html">bm::bvector&lt;&gt;</a>&amp; bv_clust = seq_clusters.<a class="code" href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">union_all_groups</a>();</div>
<div class="line">                cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot; clustered = &quot;</span> &lt;&lt; bv_clust.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>() &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">                bv_total -= bv_clust; <span class="comment">// exlude all already clustered</span></div>
<div class="line">                rcount = bv_total.<a class="code" href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">count</a>();</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot; remain = &quot;</span> &lt;&lt; rcount &lt;&lt; endl;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rcount)</div>
<div class="line">    {</div>
<div class="line">        seq_clusters.<a class="code" href="classCSeqClusters.html#ad7dea1e2db982c9ee5e73bf43e293b55">take_group</a>(bv_total);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    seq_clusters.<a class="code" href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">clear_empty_groups</a>();</div>
<div class="line">    seq_clusters.<a class="code" href="classCSeqClusters.html#a2771ddb955a6b7b945ff3b127bf28dd4">resolve_duplicates</a>(seq_coll);</div>
<div class="line">    seq_clusters.<a class="code" href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">clear_empty_groups</a>();</div>
<div class="line"> </div>
<div class="line">    seq_clusters.<a class="code" href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">print_summary</a>(<span class="stringliteral">&quot;Final clusters summary:&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a name="a129"></a><a class="code" href="xsample07a_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classCSequenceColl.html">CSequenceColl</a>          seq_coll;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ret = <a name="a130"></a><a class="code" href="xsample03_8cpp.html#a1c6cda197a32141227af69a440929ac6">parse_args</a>(argc, argv);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        {</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;cmd-line parse error. &quot;</span> &lt;&lt; endl;</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="xsample07a_8cpp.html#a9988650f5c236d5a70e710498d62904c">ifa_name</a>.empty()) <span class="comment">// FASTA file load</span></div>
<div class="line">        {</div>
<div class="line">            <a name="_a131"></a><a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(cout, <span class="stringliteral">&quot;1. Load FASTA&quot;</span>, 1, &amp;<a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// limitation: loads a single molecule only</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="keyword">auto</span> res = <a class="code" href="xsample07a_8cpp.html#a57fb672ff6d3e743da75e0d98120e714">load_FASTA</a>(<a class="code" href="xsample07a_8cpp.html#a9988650f5c236d5a70e710498d62904c">ifa_name</a>, seq_coll);</div>
<div class="line">            <span class="keywordflow">if</span> (res != 0)</div>
<div class="line">                <span class="keywordflow">return</span> res;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Sequences size = &quot;</span> &lt;&lt; seq_coll.<a class="code" href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">size</a>() &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="xsample07a_8cpp.html#a383b271ee467c0977c3fe28a579c5454">ik_size</a> &amp;&amp; !<a class="code" href="xsample07a_8cpp.html#a9988650f5c236d5a70e710498d62904c">ifa_name</a>.empty())</div>
<div class="line">        {</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(cout, <span class="stringliteral">&quot;2. Generate k-mers&quot;</span>, 1, &amp;<a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>);</div>
<div class="line">                seq_coll.<a class="code" href="classCSequenceColl.html#ad0355451628e1cad6a30b00dd5917c23">sync_buffers_size</a>();</div>
<div class="line">                <a class="code" href="xsample07a_8cpp.html#ae5a9b17aa2ea356fc5bf9b02cc8bac01">generate_k_mers_parallel</a>(seq_coll, <a class="code" href="xsample07a_8cpp.html#a383b271ee467c0977c3fe28a579c5454">ik_size</a>, <a class="code" href="xsample07a_8cpp.html#aeb19f159bbe1dcac8757cbf6b8c9a334">parallel_jobs</a>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!<a class="code" href="xsample07a_8cpp.html#a9af53e7294c27eb2b80c9e99204e9c09">ikd_name</a>.empty())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(cout, <span class="stringliteral">&quot;3. Save k-mers&quot;</span>, 1, &amp;<a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>);</div>
<div class="line">                <a class="code" href="xsample07a_8cpp.html#a3f1ef71b34674c4f7926bc05778037c7">save_kmer_buffers</a>(<a class="code" href="xsample07a_8cpp.html#a9af53e7294c27eb2b80c9e99204e9c09">ikd_name</a>, seq_coll);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="xsample07a_8cpp.html#a383b271ee467c0977c3fe28a579c5454">ik_size</a> &amp;&amp; <a class="code" href="xsample07a_8cpp.html#a9988650f5c236d5a70e710498d62904c">ifa_name</a>.empty() &amp;&amp; !<a class="code" href="xsample07a_8cpp.html#a9af53e7294c27eb2b80c9e99204e9c09">ikd_name</a>.empty())</div>
<div class="line">        {</div>
<div class="line">            {</div>
<div class="line">            <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(cout, <span class="stringliteral">&quot;4. Load k-mers&quot;</span>, 1, &amp;<a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>);</div>
<div class="line">            <a class="code" href="xsample07a_8cpp.html#a804134333821912f3013d1ab32f3e956">load_kmer_buffers</a>(<a class="code" href="xsample07a_8cpp.html#a9af53e7294c27eb2b80c9e99204e9c09">ikd_name</a>, seq_coll);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (seq_coll.<a class="code" href="classCSequenceColl.html#aad175e6424b73bda2f736b5dd30d43d1">buf_size</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="classCSeqClusters.html">CSeqClusters</a> seq_clusters;</div>
<div class="line">                <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker</a> tt1(cout, <span class="stringliteral">&quot;5. k-mer similarity clustering&quot;</span>, 1, &amp;<a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>);</div>
<div class="line">                <a class="code" href="xsample07a_8cpp.html#a006c0e66a9c90feb7d1d66f02908678d">compute_jaccard_clusters</a>(seq_clusters, seq_coll, 10, 0.05f, <a class="code" href="xsample07a_8cpp.html#aeb19f159bbe1dcac8757cbf6b8c9a334">parallel_jobs</a>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="xsample07a_8cpp.html#aece8e90d91aaea144d41103f7d2825ee">is_timing</a>)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Performance:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <a name="a132"></a><a class="code" href="classbm_1_1chrono__taker.html#a9c387f93bf26fff8b872dcd6115bf530">bm::chrono_taker&lt;&gt;::print_duration_map</a>(cout, <a class="code" href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a>, <a class="code" href="classbm_1_1chrono__taker.html">bm::chrono_taker&lt;&gt;::ct_time</a>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span>(std::exception&amp; ex)</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; ex.what() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="abm_8h_html_ad9736d9521d713fa5d48859aa720bfdd"><div class="ttname"><a href="bm_8h.html#ad9736d9521d713fa5d48859aa720bfdd">BM_DECLARE_TEMP_BLOCK</a></div><div class="ttdeci">#define BM_DECLARE_TEMP_BLOCK(x)</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00047">bm.h:47</a></div></div>
<div class="ttc" id="abmaggregator_8h_html"><div class="ttname"><a href="bmaggregator_8h.html">bmaggregator.h</a></div><div class="ttdoc">Algorithms for fast aggregation of N bvectors.</div></div>
<div class="ttc" id="abmalgo_8h_html"><div class="ttname"><a href="bmalgo_8h.html">bmalgo.h</a></div><div class="ttdoc">Algorithms for bvector&lt;&gt; (main include)</div></div>
<div class="ttc" id="abmrandom_8h_html"><div class="ttname"><a href="bmrandom_8h.html">bmrandom.h</a></div><div class="ttdoc">Generation of random subset.</div></div>
<div class="ttc" id="abmserial_8h_html"><div class="ttname"><a href="bmserial_8h.html">bmserial.h</a></div><div class="ttdoc">Serialization / compression of bvector&lt;&gt;. Set theoretical operations on compressed BLOBs.</div></div>
<div class="ttc" id="abmsparsevec__algo_8h_html"><div class="ttname"><a href="bmsparsevec__algo_8h.html">bmsparsevec_algo.h</a></div><div class="ttdoc">Algorithms for bm::sparse_vector.</div></div>
<div class="ttc" id="abmsparsevec__compr_8h_html"><div class="ttname"><a href="bmsparsevec__compr_8h.html">bmsparsevec_compr.h</a></div><div class="ttdoc">Compressed sparse container rsc_sparse_vector&lt;&gt; for integer types.</div></div>
<div class="ttc" id="abmtimer_8h_html"><div class="ttname"><a href="bmtimer_8h.html">bmtimer.h</a></div><div class="ttdoc">Timing utilities for benchmarking (internal)</div></div>
<div class="ttc" id="abmundef_8h_html"><div class="ttname"><a href="bmundef_8h.html">bmundef.h</a></div><div class="ttdoc">pre-processor un-defines to avoid global space pollution (internal)</div></div>
<div class="ttc" id="aclassCSeqClusters_html"><div class="ttname"><a href="classCSeqClusters.html">CSeqClusters</a></div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00757">xsample07a.cpp:758</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a14b9a82707e0944cb426e757a36dbeaa"><div class="ttname"><a href="classCSeqClusters.html#a14b9a82707e0944cb426e757a36dbeaa">CSeqClusters::merge_from</a></div><div class="ttdeci">void merge_from(CSeqClusters &amp;sc)</div><div class="ttdoc">Acquire all groups from another cluster collection.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00861">xsample07a.cpp:861</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a2331b4d35dd7ea86a9c1fc59e31f66e0"><div class="ttname"><a href="classCSeqClusters.html#a2331b4d35dd7ea86a9c1fc59e31f66e0">CSeqClusters::groups_size</a></div><div class="ttdeci">size_t groups_size() const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00795">xsample07a.cpp:795</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a26b012c2b38e516050a0b14644c5bb10"><div class="ttname"><a href="classCSeqClusters.html#a26b012c2b38e516050a0b14644c5bb10">CSeqClusters::elect_leaders</a></div><div class="ttdeci">void elect_leaders(const CSequenceColl &amp;seq_coll, unsigned concurrency)</div><div class="ttdoc">Find the best representatives in all cluster groups the criteria is maximum absolute similarity to al...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00994">xsample07a.cpp:994</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a2771ddb955a6b7b945ff3b127bf28dd4"><div class="ttname"><a href="classCSeqClusters.html#a2771ddb955a6b7b945ff3b127bf28dd4">CSeqClusters::resolve_duplicates</a></div><div class="ttdeci">void resolve_duplicates(const CSequenceColl &amp;seq_coll)</div><div class="ttdoc">Resolve duplicate membership between groups.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00873">xsample07a.cpp:873</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a69ed74c33e5d2b9abbeb2be4eb7949f1"><div class="ttname"><a href="classCSeqClusters.html#a69ed74c33e5d2b9abbeb2be4eb7949f1">CSeqClusters::clear_empty_groups</a></div><div class="ttdeci">void clear_empty_groups()</div><div class="ttdoc">Remove groups which turned empty after clusterization.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00807">xsample07a.cpp:807</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a70ba5a244008b79214460b0a5d9336e2"><div class="ttname"><a href="classCSeqClusters.html#a70ba5a244008b79214460b0a5d9336e2">CSeqClusters::get_group</a></div><div class="ttdeci">CSeqGroup * get_group(size_t idx)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00796">xsample07a.cpp:796</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a7269f4bb6f6852f1a13346bbff338d49"><div class="ttname"><a href="classCSeqClusters.html#a7269f4bb6f6852f1a13346bbff338d49">CSeqClusters::print_summary</a></div><div class="ttdeci">void print_summary(const char *title) const</div><div class="ttdoc">print clusterization report</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01087">xsample07a.cpp:1087</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a81b8a45ce4451e584f3f666970520ad0"><div class="ttname"><a href="classCSeqClusters.html#a81b8a45ce4451e584f3f666970520ad0">CSeqClusters::add_group</a></div><div class="ttdeci">void add_group(CSeqGroup *sg)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00766">xsample07a.cpp:766</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_a8837433904136f43c03cfe1d367203df"><div class="ttname"><a href="classCSeqClusters.html#a8837433904136f43c03cfe1d367203df">CSeqClusters::groups_vector_type</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; CSeqGroup &gt; &gt; groups_vector_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00760">xsample07a.cpp:760</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_acb483ef20f90c111400818a313694efb"><div class="ttname"><a href="classCSeqClusters.html#acb483ef20f90c111400818a313694efb">CSeqClusters::union_all_groups</a></div><div class="ttdeci">const bm::bvector &amp; union_all_groups()</div><div class="ttdoc">Compute union of all cluster group members.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00830">xsample07a.cpp:830</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_ad1e354314877bef0603a8cd97a3c37eb"><div class="ttname"><a href="classCSeqClusters.html#ad1e354314877bef0603a8cd97a3c37eb">CSeqClusters::compute_avg_count</a></div><div class="ttdeci">bm::id64_t compute_avg_count() const</div><div class="ttdoc">calculate avg cluster population count</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00847">xsample07a.cpp:847</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_ad7dea1e2db982c9ee5e73bf43e293b55"><div class="ttname"><a href="classCSeqClusters.html#ad7dea1e2db982c9ee5e73bf43e293b55">CSeqClusters::take_group</a></div><div class="ttdeci">void take_group(bm::bvector&lt;&gt; &amp;bv_members)</div><div class="ttdoc">memebers moved into their own group</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00822">xsample07a.cpp:822</a></div></div>
<div class="ttc" id="aclassCSeqClusters_html_afe35ef86fc5c745c8b31c17959988576"><div class="ttname"><a href="classCSeqClusters.html#afe35ef86fc5c745c8b31c17959988576">CSeqClusters::CSeqClusters</a></div><div class="ttdeci">CSeqClusters()</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00762">xsample07a.cpp:762</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html"><div class="ttname"><a href="classCSeqGroup.html">CSeqGroup</a></div><div class="ttdoc">Group (clustrer) of sequences.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00686">xsample07a.cpp:687</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_a002d709f3853dc286885c41c096f1dec"><div class="ttname"><a href="classCSeqGroup.html#a002d709f3853dc286885c41c096f1dec">CSeqGroup::get_members</a></div><div class="ttdeci">const bm::bvector &amp; get_members() const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00736">xsample07a.cpp:736</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_a46f86527c0558773febb4e032aa9dd3f"><div class="ttname"><a href="classCSeqGroup.html#a46f86527c0558773febb4e032aa9dd3f">CSeqGroup::count_and_union_sync</a></div><div class="ttdeci">bm::id64_t count_and_union_sync(const bm::bvector&lt;&gt; &amp;bv)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00725">xsample07a.cpp:725</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_a4cfdeb16254f1fa0954e730cf0cc068a"><div class="ttname"><a href="classCSeqGroup.html#a4cfdeb16254f1fa0954e730cf0cc068a">CSeqGroup::get_kmer_union</a></div><div class="ttdeci">bm::bvector &amp; get_kmer_union()</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00739">xsample07a.cpp:739</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_a4d11366bb04743841cb36fd93ebadbe5"><div class="ttname"><a href="classCSeqGroup.html#a4d11366bb04743841cb36fd93ebadbe5">CSeqGroup::CSeqGroup</a></div><div class="ttdeci">CSeqGroup(bm::id64_t lead_id=~0ull)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00689">xsample07a.cpp:689</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_a5b37e6be126e44f0deb9e8ba82a52f48"><div class="ttname"><a href="classCSeqGroup.html#a5b37e6be126e44f0deb9e8ba82a52f48">CSeqGroup::add_member_sync</a></div><div class="ttdeci">void add_member_sync(bm::id64_t id, const bm::bvector&lt;&gt; &amp;bv_kmer)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00711">xsample07a.cpp:711</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_a74e8e1247f72e346d73c7200d8029381"><div class="ttname"><a href="classCSeqGroup.html#a74e8e1247f72e346d73c7200d8029381">CSeqGroup::set_lead</a></div><div class="ttdeci">void set_lead(bm::id64_t lead_id)</div><div class="ttdoc">set id for the group representative</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00696">xsample07a.cpp:696</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_aa83d86b38999b3e90d68654126120129"><div class="ttname"><a href="classCSeqGroup.html#aa83d86b38999b3e90d68654126120129">CSeqGroup::get_rep</a></div><div class="ttdeci">bm::bvector &amp; get_rep()</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00733">xsample07a.cpp:733</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_ab14ad440236209231990885651ef88b5"><div class="ttname"><a href="classCSeqGroup.html#ab14ad440236209231990885651ef88b5">CSeqGroup::add_member</a></div><div class="ttdeci">void add_member(bm::id64_t id)</div><div class="ttdoc">add a member to the group</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00705">xsample07a.cpp:705</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_aea7eefd35468ee3e3abf6ec4baf1afc4"><div class="ttname"><a href="classCSeqGroup.html#aea7eefd35468ee3e3abf6ec4baf1afc4">CSeqGroup::merge_member_sync</a></div><div class="ttdeci">void merge_member_sync(bm::bvector&lt;&gt; &amp;bv_seq, bm::bvector&lt;&gt; &amp;bv_kmer)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00718">xsample07a.cpp:718</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_aef7c748975302832ac3f57591fab03e8"><div class="ttname"><a href="classCSeqGroup.html#aef7c748975302832ac3f57591fab03e8">CSeqGroup::is_assigned</a></div><div class="ttdeci">bool is_assigned()</div><div class="ttdoc">check is cluster is non-empty</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00702">xsample07a.cpp:702</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_aefb369a16b26c57c882ec98de85aa602"><div class="ttname"><a href="classCSeqGroup.html#aefb369a16b26c57c882ec98de85aa602">CSeqGroup::get_lead</a></div><div class="ttdeci">bm::id64_t get_lead() const</div><div class="ttdoc">Get lead id.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00699">xsample07a.cpp:699</a></div></div>
<div class="ttc" id="aclassCSeqGroup_html_af5aaf9dde691393c657d02c8abe5b488"><div class="ttname"><a href="classCSeqGroup.html#af5aaf9dde691393c657d02c8abe5b488">CSeqGroup::clear_member</a></div><div class="ttdeci">void clear_member(bm::id64_t id)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00731">xsample07a.cpp:731</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html"><div class="ttname"><a href="classCSequenceColl.html">CSequenceColl</a></div><div class="ttdoc">Collection of sequences and k-mer fingerprint vectors.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00130">xsample07a.cpp:131</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_a29a07b14da0a706004fbee21f2d7e9cd"><div class="ttname"><a href="classCSequenceColl.html#a29a07b14da0a706004fbee21f2d7e9cd">CSequenceColl::add_sequence</a></div><div class="ttdeci">void add_sequence(const string &amp;acc, vector_char_type *seq_ptr)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00140">xsample07a.cpp:140</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_a4fcafecf4680670641820eb42d8d38fe"><div class="ttname"><a href="classCSequenceColl.html#a4fcafecf4680670641820eb42d8d38fe">CSequenceColl::deserialize_k_mers</a></div><div class="ttdeci">void deserialize_k_mers(bvector_ptr_vector_type &amp;k_mers_vect, const bm::bvector&lt;&gt; &amp;bv_req, bm::bvector&lt;&gt;::size_type bv_req_count) const</div><div class="ttdoc">Deserialize group of k-mer fingerprint vectors.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00208">xsample07a.cpp:208</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_a50104368c650b21bc0251d67db4da4cf"><div class="ttname"><a href="classCSequenceColl.html#a50104368c650b21bc0251d67db4da4cf">CSequenceColl::total_seq_size</a></div><div class="ttdeci">size_t total_seq_size() const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00171">xsample07a.cpp:171</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_a63c37638151342def969307eabff8cb9"><div class="ttname"><a href="classCSequenceColl.html#a63c37638151342def969307eabff8cb9">CSequenceColl::buffer_type</a></div><div class="ttdeci">std::vector&lt; unsigned char &gt; buffer_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00133">xsample07a.cpp:133</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_a939e26988240fa9be32579a5e8b228d0"><div class="ttname"><a href="classCSequenceColl.html#a939e26988240fa9be32579a5e8b228d0">CSequenceColl::get_sequence</a></div><div class="ttdeci">const vector_char_type &amp; get_sequence(size_t i) const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00167">xsample07a.cpp:167</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_aa44fdfaddf73a6eb2076c59cad656bae"><div class="ttname"><a href="classCSequenceColl.html#aa44fdfaddf73a6eb2076c59cad656bae">CSequenceColl::get_buf_size</a></div><div class="ttdeci">size_t get_buf_size(size_t i) const</div><div class="ttdoc">Get k-mer vector BLOB size.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00183">xsample07a.cpp:183</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_aa80ea44f1886d65d14d1deec70ba8686"><div class="ttname"><a href="classCSequenceColl.html#aa80ea44f1886d65d14d1deec70ba8686">CSequenceColl::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00163">xsample07a.cpp:163</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_aad175e6424b73bda2f736b5dd30d43d1"><div class="ttname"><a href="classCSequenceColl.html#aad175e6424b73bda2f736b5dd30d43d1">CSequenceColl::buf_size</a></div><div class="ttdeci">size_t buf_size() const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00180">xsample07a.cpp:180</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_ab2e69c59e59ac6fcac55e077fc5aed05"><div class="ttname"><a href="classCSequenceColl.html#ab2e69c59e59ac6fcac55e077fc5aed05">CSequenceColl::seq_size</a></div><div class="ttdeci">size_t seq_size(size_t i) const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00169">xsample07a.cpp:169</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_ac0a3e3e273980d2799450f43b6a54aff"><div class="ttname"><a href="classCSequenceColl.html#ac0a3e3e273980d2799450f43b6a54aff">CSequenceColl::CSequenceColl</a></div><div class="ttdeci">CSequenceColl()</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00136">xsample07a.cpp:136</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_acc61c9285b49db25ae9d1f99ccad6bee"><div class="ttname"><a href="classCSequenceColl.html#acc61c9285b49db25ae9d1f99ccad6bee">CSequenceColl::get_acc</a></div><div class="ttdeci">const string &amp; get_acc(size_t i) const</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00166">xsample07a.cpp:166</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_ad0355451628e1cad6a30b00dd5917c23"><div class="ttname"><a href="classCSequenceColl.html#ad0355451628e1cad6a30b00dd5917c23">CSequenceColl::sync_buffers_size</a></div><div class="ttdeci">void sync_buffers_size()</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00158">xsample07a.cpp:158</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_ae555e53331885b0093c4991dec44730d"><div class="ttname"><a href="classCSequenceColl.html#ae555e53331885b0093c4991dec44730d">CSequenceColl::set_buffer</a></div><div class="ttdeci">void set_buffer(size_t i, const buffer_type &amp;buf)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00146">xsample07a.cpp:146</a></div></div>
<div class="ttc" id="aclassCSequenceColl_html_af5123cdb985c8b8206ea5b59c802e2e1"><div class="ttname"><a href="classCSequenceColl.html#af5123cdb985c8b8206ea5b59c802e2e1">CSequenceColl::get_buf</a></div><div class="ttdeci">const unsigned char * get_buf(size_t i) const</div><div class="ttdoc">Get k-mer BLOB pointer.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00186">xsample07a.cpp:186</a></div></div>
<div class="ttc" id="aclassbm_1_1aggregator_html"><div class="ttname"><a href="classbm_1_1aggregator.html">bm::aggregator&lt; bvector_type &gt;</a></div></div>
<div class="ttc" id="aclassbm_1_1aggregator_html_a57130ddfcf21b086c66a3cc115c2238c"><div class="ttname"><a href="classbm_1_1aggregator.html#a57130ddfcf21b086c66a3cc115c2238c">bm::aggregator::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">Reset aggregate groups, forget all attached vectors.</div><div class="ttdef"><b>Definition:</b> <a href="bmaggregator_8h_source.html#l00919">bmaggregator.h:919</a></div></div>
<div class="ttc" id="aclassbm_1_1aggregator_html_a650fc3a5385c98a7b8bc7bf188ce4487"><div class="ttname"><a href="classbm_1_1aggregator.html#a650fc3a5385c98a7b8bc7bf188ce4487">bm::aggregator::combine_or</a></div><div class="ttdeci">void combine_or(bvector_type &amp;bv_target)</div><div class="ttdoc">Aggregate added group of vectors using logical OR Operation does NOT perform an explicit reset of arg...</div><div class="ttdef"><b>Definition:</b> <a href="bmaggregator_8h_source.html#l00981">bmaggregator.h:981</a></div></div>
<div class="ttc" id="aclassbm_1_1aggregator_html_a81093f82893bd49a84ff9064e1e40c50"><div class="ttname"><a href="classbm_1_1aggregator.html#a81093f82893bd49a84ff9064e1e40c50">bm::aggregator::set_optimization</a></div><div class="ttdeci">void set_optimization(typename bvector_type::optmode opt=bvector_type::opt_compress) BMNOEXCEPT</div><div class="ttdoc">set on-the-fly bit-block compression By default aggregator does not try to optimize result,...</div><div class="ttdef"><b>Definition:</b> <a href="bmaggregator_8h_source.html#l00359">bmaggregator.h:359</a></div></div>
<div class="ttc" id="aclassbm_1_1aggregator_html_a8ec1f6bd580be40081b0fe494ee45b02"><div class="ttname"><a href="classbm_1_1aggregator.html#a8ec1f6bd580be40081b0fe494ee45b02">bm::aggregator::add</a></div><div class="ttdeci">size_t add(const bvector_type *bv, unsigned agr_group=0)</div><div class="ttdoc">Attach source bit-vector to a argument group (0 or 1).</div><div class="ttdef"><b>Definition:</b> <a href="bmaggregator_8h_source.html#l00973">bmaggregator.h:973</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_1_1enumerator_html"><div class="ttname"><a href="classbm_1_1bvector_1_1enumerator.html">bm::bvector::enumerator</a></div><div class="ttdoc">Constant iterator designed to enumerate &quot;ON&quot; bits.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00602">bm.h:603</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_1_1iterator__base_html_a3f6af7f5b46c0219b28916187d302c43"><div class="ttname"><a href="classbm_1_1bvector_1_1iterator__base.html#a3f6af7f5b46c0219b28916187d302c43">bm::bvector::iterator_base::valid</a></div><div class="ttdeci">bool valid() const BMNOEXCEPT</div><div class="ttdoc">Checks if iterator is still valid.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00283">bm.h:283</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_1_1mem__pool__guard_html"><div class="ttname"><a href="classbm_1_1bvector_1_1mem__pool__guard.html">bm::bvector::mem_pool_guard</a></div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00789">bm.h:790</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_1_1mem__pool__guard_html_a41c7e5db1df7b29b0fbc37c75ac826b1"><div class="ttname"><a href="classbm_1_1bvector_1_1mem__pool__guard.html#a41c7e5db1df7b29b0fbc37c75ac826b1">bm::bvector::mem_pool_guard::assign_if_not_set</a></div><div class="ttdeci">void assign_if_not_set(allocator_pool_type &amp;pool, bvector&lt; Alloc &gt; &amp;bv) BMNOEXCEPT</div><div class="ttdoc">check if vector has no assigned allocator and set one</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00807">bm.h:807</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html"><div class="ttname"><a href="classbm_1_1bvector.html">bm::bvector</a></div><div class="ttdoc">Bitvector Bit-vector container with runtime compression of bits.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00114">bm.h:115</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a16d902c3df4aa6aa88d8e137af4a4b9b"><div class="ttname"><a href="classbm_1_1bvector.html#a16d902c3df4aa6aa88d8e137af4a4b9b">bm::bvector::test</a></div><div class="ttdeci">bool test(size_type n) const BMNOEXCEPT</div><div class="ttdoc">returns true if bit n is set and false is bit n is 0.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l01514">bm.h:1514</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a237170e9f988319665bbcac2cd10e24e"><div class="ttname"><a href="classbm_1_1bvector.html#a237170e9f988319665bbcac2cd10e24e">bm::bvector::merge</a></div><div class="ttdeci">void merge(bm::bvector&lt; Alloc &gt; &amp;bvect)</div><div class="ttdoc">Merge/move content from another vector.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l05599">bm.h:5599</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a2c8990a2147fdc3e6094011e77e559e8"><div class="ttname"><a href="classbm_1_1bvector.html#a2c8990a2147fdc3e6094011e77e559e8">bm::bvector::allocator_pool_type</a></div><div class="ttdeci">allocator_type::allocator_pool_type allocator_pool_type</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00118">bm.h:118</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a3009ba9b116f13f4933a48641f3a695d"><div class="ttname"><a href="classbm_1_1bvector.html#a3009ba9b116f13f4933a48641f3a695d">bm::bvector::count</a></div><div class="ttdeci">size_type count() const BMNOEXCEPT</div><div class="ttdoc">population count (count of ON bits)</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l02399">bm.h:2399</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a37c1ccb4755c61450311918ad3330aa6"><div class="ttname"><a href="classbm_1_1bvector.html#a37c1ccb4755c61450311918ad3330aa6">bm::bvector::bit_and</a></div><div class="ttdeci">bm::bvector&lt; Alloc &gt; &amp; bit_and(const bm::bvector&lt; Alloc &gt; &amp;bv1, const bm::bvector&lt; Alloc &gt; &amp;bv2, typename bm::bvector&lt; Alloc &gt;::optmode opt_mode=opt_none)</div><div class="ttdoc">3-operand AND : this := bv1 AND bv2</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l05901">bm.h:5901</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a52b4259a5cc4ebd8953832c696e24f02"><div class="ttname"><a href="classbm_1_1bvector.html#a52b4259a5cc4ebd8953832c696e24f02">bm::bvector::set</a></div><div class="ttdeci">bvector&lt; Alloc &gt; &amp; set(size_type n, bool val=true)</div><div class="ttdoc">Sets bit n if val is true, clears bit n if val is false.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l04178">bm.h:4178</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a5caf8104ebf999f36fc1f812aaff0bd5"><div class="ttname"><a href="classbm_1_1bvector.html#a5caf8104ebf999f36fc1f812aaff0bd5">bm::bvector::set_allocator_pool</a></div><div class="ttdeci">void set_allocator_pool(allocator_pool_type *pool_ptr) BMNOEXCEPT</div><div class="ttdoc">Set allocator pool for local (non-th readed) memory cyclic(lots of alloc-free ops) opertations.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l01060">bm.h:1060</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a622e6827d799a561e2f0db28f7ac19d2"><div class="ttname"><a href="classbm_1_1bvector.html#a622e6827d799a561e2f0db28f7ac19d2">bm::bvector::optimize</a></div><div class="ttdeci">void optimize(bm::word_t *temp_block=0, optmode opt_mode=opt_compress, statistics *stat=0)</div><div class="ttdoc">Optimize memory bitvector's memory allocation.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l03625">bm.h:3625</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a69729bae3fca407ff1228cf2db761adb"><div class="ttname"><a href="classbm_1_1bvector.html#a69729bae3fca407ff1228cf2db761adb">bm::bvector::any</a></div><div class="ttdeci">bool any() const BMNOEXCEPT</div><div class="ttdoc">Returns true if any bits in this bitset are set, and otherwise returns false.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l02449">bm.h:2449</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a7fea809653a2792c84fd10c92b5c47c4"><div class="ttname"><a href="classbm_1_1bvector.html#a7fea809653a2792c84fd10c92b5c47c4">bm::bvector::size_type</a></div><div class="ttdeci">bvector_size_type size_type</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00121">bm.h:121</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a86b939f3aed555dc073e8c26e9efea71"><div class="ttname"><a href="classbm_1_1bvector.html#a86b939f3aed555dc073e8c26e9efea71">bm::bvector::first</a></div><div class="ttdeci">enumerator first() const</div><div class="ttdoc">Returns enumerator pointing on the first non-zero bit.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l01883">bm.h:1883</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a9764b5a36f4b012d1e4b4dbef4e85d0e"><div class="ttname"><a href="classbm_1_1bvector.html#a9764b5a36f4b012d1e4b4dbef4e85d0e">bm::bvector::swap</a></div><div class="ttdeci">void swap(bvector&lt; Alloc &gt; &amp;bvect) BMNOEXCEPT</div><div class="ttdoc">Exchanges content of bv and this bvector.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l03956">bm.h:3956</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a99395aaa8ab689455054bda9b261de60"><div class="ttname"><a href="classbm_1_1bvector.html#a99395aaa8ab689455054bda9b261de60">bm::bvector::count_range</a></div><div class="ttdeci">size_type count_range(size_type left, size_type right, const rs_index_type &amp;rs_idx) const BMNOEXCEPT</div><div class="ttdoc">Returns count of 1 bits in the given range [left..right] Uses rank-select index to accelerate the sea...</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l03507">bm.h:3507</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_a9ab6964e14405327936d183a11dcd455"><div class="ttname"><a href="classbm_1_1bvector.html#a9ab6964e14405327936d183a11dcd455">bm::bvector::get_first</a></div><div class="ttdeci">size_type get_first() const BMNOEXCEPT</div><div class="ttdoc">find first 1 bit in vector. Function may return 0 and this requires an extra check if bit 0 is actual...</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l01612">bm.h:1612</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_aafb2ecaa1a55856533e6b4afbf788eae"><div class="ttname"><a href="classbm_1_1bvector.html#aafb2ecaa1a55856533e6b4afbf788eae">bm::bvector::set_range</a></div><div class="ttdeci">bvector&lt; Alloc &gt; &amp; set_range(size_type left, size_type right, bool value=true)</div><div class="ttdoc">Sets all bits in the specified closed interval [left,right] Interval must be inside the bvector's siz...</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l02366">bm.h:2366</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_ac6f13fa4ba188585e5c5d4e89843a44e"><div class="ttname"><a href="classbm_1_1bvector.html#ac6f13fa4ba188585e5c5d4e89843a44e">bm::bvector::clear</a></div><div class="ttdeci">void clear(const size_type *ids, size_type ids_size, bm::sort_order so=bm::BM_UNKNOWN)</div><div class="ttdoc">clear list of bits in this bitset</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l04139">bm.h:4139</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_ad1dbe63690fd5cd2b1e064795d3f1b6c"><div class="ttname"><a href="classbm_1_1bvector.html#ad1dbe63690fd5cd2b1e064795d3f1b6c">bm::bvector::allocator_type</a></div><div class="ttdeci">Alloc allocator_type</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00117">bm.h:117</a></div></div>
<div class="ttc" id="aclassbm_1_1bvector_html_aff4c0900eed72eaccff6f5804e33ce97"><div class="ttname"><a href="classbm_1_1bvector.html#aff4c0900eed72eaccff6f5804e33ce97">bm::bvector::set_bit_no_check</a></div><div class="ttdeci">void set_bit_no_check(size_type n)</div><div class="ttdoc">Set bit without checking preconditions (size, etc)</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l04426">bm.h:4426</a></div></div>
<div class="ttc" id="aclassbm_1_1chrono__taker_html"><div class="ttname"><a href="classbm_1_1chrono__taker.html">bm::chrono_taker</a></div><div class="ttdoc">Utility class to collect performance measurements and statistics.</div><div class="ttdef"><b>Definition:</b> <a href="bmtimer_8h_source.html#l00040">bmtimer.h:41</a></div></div>
<div class="ttc" id="aclassbm_1_1chrono__taker_html_a952d06d260d1c98f95056e871bb8d3a0"><div class="ttname"><a href="classbm_1_1chrono__taker.html#a952d06d260d1c98f95056e871bb8d3a0">bm::chrono_taker::duration_map_type</a></div><div class="ttdeci">std::map&lt; std::string, statistics &gt; duration_map_type</div><div class="ttdoc">test name to duration map</div><div class="ttdef"><b>Definition:</b> <a href="bmtimer_8h_source.html#l00066">bmtimer.h:66</a></div></div>
<div class="ttc" id="aclassbm_1_1chrono__taker_html_a9c387f93bf26fff8b872dcd6115bf530"><div class="ttname"><a href="classbm_1_1chrono__taker.html#a9c387f93bf26fff8b872dcd6115bf530">bm::chrono_taker::print_duration_map</a></div><div class="ttdeci">static void print_duration_map(TOut &amp;tout, const duration_map_type &amp;dmap, format fmt=ct_time)</div><div class="ttdef"><b>Definition:</b> <a href="bmtimer_8h_source.html#l00150">bmtimer.h:150</a></div></div>
<div class="ttc" id="aclassbm_1_1operation__deserializer_html"><div class="ttname"><a href="classbm_1_1operation__deserializer.html">bm::operation_deserializer</a></div><div class="ttdoc">Deserializer, performs logical operations between bit-vector and serialized bit-vector.</div><div class="ttdef"><b>Definition:</b> <a href="bmserial_8h_source.html#l00929">bmserial.h:930</a></div></div>
<div class="ttc" id="aclassbm_1_1operation__deserializer_html_a67b82bd495cfa83a2d528a739b6d2cb7"><div class="ttname"><a href="classbm_1_1operation__deserializer.html#a67b82bd495cfa83a2d528a739b6d2cb7">bm::operation_deserializer::deserialize</a></div><div class="ttdeci">size_type deserialize(bvector_type &amp;bv, const unsigned char *buf, set_operation op, bool exit_on_one=false)</div><div class="ttdoc">Deserialize bvector using buffer as set operation argument.</div><div class="ttdef"><b>Definition:</b> <a href="bmserial_8h_source.html#l06579">bmserial.h:6579</a></div></div>
<div class="ttc" id="aclassbm_1_1random__subset_html"><div class="ttname"><a href="classbm_1_1random__subset.html">bm::random_subset</a></div><div class="ttdef"><b>Definition:</b> <a href="bmrandom_8h_source.html#l00056">bmrandom.h:57</a></div></div>
<div class="ttc" id="aclassbm_1_1random__subset_html_abdf1e716e124ff4d7ad8ccef1646c99e"><div class="ttname"><a href="classbm_1_1random__subset.html#abdf1e716e124ff4d7ad8ccef1646c99e">bm::random_subset::sample</a></div><div class="ttdeci">void sample(BV &amp;bv_out, const BV &amp;bv_in, size_type sample_count)</div><div class="ttdoc">Get random subset of input vector.</div><div class="ttdef"><b>Definition:</b> <a href="bmrandom_8h_source.html#l00140">bmrandom.h:140</a></div></div>
<div class="ttc" id="aclassbm_1_1serializer_html"><div class="ttname"><a href="classbm_1_1serializer.html">bm::serializer</a></div><div class="ttdoc">Bit-vector serialization class.</div><div class="ttdef"><b>Definition:</b> <a href="bmserial_8h_source.html#l00075">bmserial.h:76</a></div></div>
<div class="ttc" id="aclassbm_1_1serializer_html_a89cebac62eb991ee3f4a5b805a255e81"><div class="ttname"><a href="classbm_1_1serializer.html#a89cebac62eb991ee3f4a5b805a255e81">bm::serializer::set_bookmarks</a></div><div class="ttdeci">void set_bookmarks(bool enable, unsigned bm_interval=256) BMNOEXCEPT</div><div class="ttdoc">Add skip-markers to serialization BLOB for faster range decode at the expense of some BLOB size incre...</div><div class="ttdef"><b>Definition:</b> <a href="bmserial_8h_source.html#l01287">bmserial.h:1287</a></div></div>
<div class="ttc" id="aclassbm_1_1serializer_html_af4fcd3cfdbf46e2e746a8790674ea5f9"><div class="ttname"><a href="classbm_1_1serializer.html#af4fcd3cfdbf46e2e746a8790674ea5f9">bm::serializer::serialize</a></div><div class="ttdeci">size_type serialize(const BV &amp;bv, unsigned char *buf, size_t buf_size)</div><div class="ttdoc">Bitvector serialization into memory block.</div><div class="ttdef"><b>Definition:</b> <a href="bmserial_8h_source.html#l02706">bmserial.h:2706</a></div></div>
<div class="ttc" id="agroup__bvector_html_gga04a7a7cda4bf04cd107e198b3b1e4ed8a78505da4a29a1a7e3381d9d28d41953e"><div class="ttname"><a href="group__bvector.html#gga04a7a7cda4bf04cd107e198b3b1e4ed8a78505da4a29a1a7e3381d9d28d41953e">bm::BM_SORTED</a></div><div class="ttdeci">@ BM_SORTED</div><div class="ttdoc">input set is sorted (ascending order)</div><div class="ttdef"><b>Definition:</b> <a href="bmconst_8h_source.html#l00205">bmconst.h:205</a></div></div>
<div class="ttc" id="agroup__bvector_html_gga76b70d2b9182a6dcac151d1bd9ec6109a378be4b14cee6a341e859fd3157ab959"><div class="ttname"><a href="group__bvector.html#gga76b70d2b9182a6dcac151d1bd9ec6109a378be4b14cee6a341e859fd3157ab959">bm::set_COUNT_AND</a></div><div class="ttdeci">@ set_COUNT_AND</div><div class="ttdef"><b>Definition:</b> <a href="bmconst_8h_source.html#l00174">bmconst.h:174</a></div></div>
<div class="ttc" id="agroup__bvector_html_ggad0b87b3b7292383a864d27feaf1c9effa7fe09d1d7c62a813db922c396c0cbc9c"><div class="ttname"><a href="group__bvector.html#ggad0b87b3b7292383a864d27feaf1c9effa7fe09d1d7c62a813db922c396c0cbc9c">bm::BM_GAP</a></div><div class="ttdeci">@ BM_GAP</div><div class="ttdoc">GAP compression is ON.</div><div class="ttdef"><b>Definition:</b> <a href="bmconst_8h_source.html#l00148">bmconst.h:147</a></div></div>
<div class="ttc" id="agroup__bvserial_html_ga6e8907a847b2b124fe97b244aa9e0306"><div class="ttname"><a href="group__bvserial.html#ga6e8907a847b2b124fe97b244aa9e0306">bm::deserialize</a></div><div class="ttdeci">size_t deserialize(BV &amp;bv, const unsigned char *buf, bm::word_t *temp_block=0, const bm::bv_ref_vector&lt; BV &gt; *ref_vect=0)</div><div class="ttdoc">Bitvector deserialization from a memory BLOB.</div><div class="ttdef"><b>Definition:</b> <a href="bmserial_8h_source.html#l03140">bmserial.h:3140</a></div></div>
<div class="ttc" id="agroup__setalgo_html_ga0ccd47207b6838dd6b7f97c285ebdb15"><div class="ttname"><a href="group__setalgo.html#ga0ccd47207b6838dd6b7f97c285ebdb15">bm::rank_range_split</a></div><div class="ttdeci">void rank_range_split(const BV &amp;bv, typename BV::size_type rank, PairVect &amp;target_v)</div><div class="ttdoc">Algorithm to identify bit-vector ranges (splits) for the rank.</div><div class="ttdef"><b>Definition:</b> <a href="bmalgo_8h_source.html#l00430">bmalgo.h:430</a></div></div>
<div class="ttc" id="agroup__setalgo_html_ga5fb1131811b7b834dfc56a3874667a65"><div class="ttname"><a href="group__setalgo.html#ga5fb1131811b7b834dfc56a3874667a65">bm::count_and</a></div><div class="ttdeci">BV::size_type count_and(const BV &amp;bv1, const BV &amp;bv2) BMNOEXCEPT</div><div class="ttdoc">Computes bitcount of AND operation of two bitsets.</div><div class="ttdef"><b>Definition:</b> <a href="bmalgo_8h_source.html#l00049">bmalgo.h:49</a></div></div>
<div class="ttc" id="anamespacebm_html"><div class="ttname"><a href="namespacebm.html">bm</a></div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00077">bm.h:78</a></div></div>
<div class="ttc" id="anamespacebm_html_a933991b5bb4ce62227584037909e9195"><div class="ttname"><a href="namespacebm.html#a933991b5bb4ce62227584037909e9195">bm::id64_t</a></div><div class="ttdeci">unsigned long long int id64_t</div><div class="ttdef"><b>Definition:</b> <a href="bmconst_8h_source.html#l00035">bmconst.h:35</a></div></div>
<div class="ttc" id="asample24_8cpp_html_a7abca04faa4bc9e482801161aed87e64"><div class="ttname"><a href="sample24_8cpp.html#a7abca04faa4bc9e482801161aed87e64">bv_ranges_vector</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; bv_size_type, bv_size_type &gt; &gt; bv_ranges_vector</div><div class="ttdef"><b>Definition:</b> <a href="sample24_8cpp_source.html#l00055">sample24.cpp:55</a></div></div>
<div class="ttc" id="astructCKMerAcc_html"><div class="ttname"><a href="structCKMerAcc.html">CKMerAcc</a></div><div class="ttdoc">Utility class to accumulate cahnges to cluster before commiting it (mutex syncronous operation)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01214">xsample07a.cpp:1215</a></div></div>
<div class="ttc" id="astructCKMerAcc_html_a3dc2baa2e6a20c61a684a29901df538f"><div class="ttname"><a href="structCKMerAcc.html#a3dc2baa2e6a20c61a684a29901df538f">CKMerAcc::add</a></div><div class="ttdeci">void add(size_t cluster_id, bm::bvector&lt;&gt;::size_type m_id, bm::bvector&lt;&gt; &amp;bv_kmer)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01220">xsample07a.cpp:1220</a></div></div>
<div class="ttc" id="astructCKMerAcc_html_a7406e333e0a350497ec77d6ff03ce79d"><div class="ttname"><a href="structCKMerAcc.html#a7406e333e0a350497ec77d6ff03ce79d">CKMerAcc::bv_kmers</a></div><div class="ttdeci">bvector_ptr_vector_type bv_kmers</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01238">xsample07a.cpp:1238</a></div></div>
<div class="ttc" id="astructCKMerAcc_html_a91803d7e1b28660a20bc6a88ca9b2656"><div class="ttname"><a href="structCKMerAcc.html#a91803d7e1b28660a20bc6a88ca9b2656">CKMerAcc::bv_members</a></div><div class="ttdeci">bvector_ptr_vector_type bv_members</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01237">xsample07a.cpp:1237</a></div></div>
<div class="ttc" id="astructCKMerAcc_html_af11d3fa42f54b623011cad947bf3bd2e"><div class="ttname"><a href="structCKMerAcc.html#af11d3fa42f54b623011cad947bf3bd2e">CKMerAcc::CKMerAcc</a></div><div class="ttdeci">CKMerAcc(size_t sz)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01216">xsample07a.cpp:1216</a></div></div>
<div class="ttc" id="astructbm_1_1bv__statistics_html_acf1547fe85bf8562dde286488d567f35"><div class="ttname"><a href="structbm_1_1bv__statistics.html#acf1547fe85bf8562dde286488d567f35">bm::bv_statistics::max_serialize_mem</a></div><div class="ttdeci">size_t max_serialize_mem</div><div class="ttdoc">estimated maximum memory for serialization</div><div class="ttdef"><b>Definition:</b> <a href="bmfunc_8h_source.html#l00061">bmfunc.h:61</a></div></div>
<div class="ttc" id="astructbm_1_1bvector_1_1statistics_html"><div class="ttname"><a href="structbm_1_1bvector_1_1statistics.html">bm::bvector::statistics</a></div><div class="ttdoc">Statistical information about bitset's memory allocation details.</div><div class="ttdef"><b>Definition:</b> <a href="bm_8h_source.html#l00124">bm.h:125</a></div></div>
<div class="ttc" id="axsample03_8cpp_html_a1c6cda197a32141227af69a440929ac6"><div class="ttname"><a href="xsample03_8cpp.html#a1c6cda197a32141227af69a440929ac6">parse_args</a></div><div class="ttdeci">static int parse_args(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="xsample03_8cpp_source.html#l00110">xsample03.cpp:110</a></div></div>
<div class="ttc" id="axsample06_8cpp_html_a9eb066bc7179fb40780c2160bc69a52d"><div class="ttname"><a href="xsample06_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a></div><div class="ttdeci">std::vector&lt; char &gt; vector_char_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample06_8cpp_source.html#l00133">xsample06.cpp:133</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a006c0e66a9c90feb7d1d66f02908678d"><div class="ttname"><a href="xsample07a_8cpp.html#a006c0e66a9c90feb7d1d66f02908678d">compute_jaccard_clusters</a></div><div class="ttdeci">static void compute_jaccard_clusters(CSeqClusters &amp;seq_clusters, const CSequenceColl &amp;seq_coll, unsigned num_clust, float similarity_cut_off, unsigned concurrency)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01420">xsample07a.cpp:1420</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a04974186e38ba1fa8512639ebc3987bf"><div class="ttname"><a href="xsample07a_8cpp.html#a04974186e38ba1fa8512639ebc3987bf">assign_to_best_cluster</a></div><div class="ttdeci">static void assign_to_best_cluster(CSeqClusters &amp;cluster_groups, const CSequenceColl &amp;seq_coll, const bm::bvector&lt;&gt; &amp;bv_seq_ids, bm::bvector&lt;&gt;::size_type seq_id_from, bm::bvector&lt;&gt;::size_type seq_id_to)</div><div class="ttdoc">Compute AND similarity to all available clusters assign to the most similar using cluster representat...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01245">xsample07a.cpp:1245</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="xsample07a_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01584">xsample07a.cpp:1584</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a0ffef2be9bf95d1f3f5ffaf6d6489456"><div class="ttname"><a href="xsample07a_8cpp.html#a0ffef2be9bf95d1f3f5ffaf6d6489456">bv_size_type</a></div><div class="ttdeci">bvector_type::size_type bv_size_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00098">xsample07a.cpp:98</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a215ea2e60054a2ccc30a0f8b1e8a4dfc"><div class="ttname"><a href="xsample07a_8cpp.html#a215ea2e60054a2ccc30a0f8b1e8a4dfc">generate_k_mers</a></div><div class="ttdeci">static void generate_k_mers(CSequenceColl &amp;seq_coll, unsigned k_size, size_t from, size_t to)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00561">xsample07a.cpp:561</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a2217aa988f24f927c4da2f9057b80f5e"><div class="ttname"><a href="xsample07a_8cpp.html#a2217aa988f24f927c4da2f9057b80f5e">compute_random_clusters</a></div><div class="ttdeci">static void compute_random_clusters(CSeqClusters &amp;cluster_groups, const CSequenceColl &amp;seq_coll, const bm::bvector&lt;&gt; &amp;bv_total, bm::random_subset&lt; bvector_type &gt; &amp;rsub, unsigned num_clust, float similarity_cut_off, unsigned concurrency)</div><div class="ttdoc">Pick random sequences as cluster seed elements, try attach initial sequences based on weighted simila...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01374">xsample07a.cpp:1374</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a2f9e440e48637e03efd999efc9b352fc"><div class="ttname"><a href="xsample07a_8cpp.html#a2f9e440e48637e03efd999efc9b352fc">ikd_rep_name</a></div><div class="ttdeci">std::string ikd_rep_name</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00079">xsample07a.cpp:79</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a375552213e6e0f946f44c3c19520df7f"><div class="ttname"><a href="xsample07a_8cpp.html#a375552213e6e0f946f44c3c19520df7f">wait_for_slot</a></div><div class="ttdeci">void wait_for_slot(FV &amp;futures, unsigned *parallel_cnt, unsigned concurrency)</div><div class="ttdoc">wait for any opening in a list of futures used to schedule parallel tasks with CPU overbooking contro...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00111">xsample07a.cpp:111</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a383b271ee467c0977c3fe28a579c5454"><div class="ttname"><a href="xsample07a_8cpp.html#a383b271ee467c0977c3fe28a579c5454">ik_size</a></div><div class="ttdeci">unsigned ik_size</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00084">xsample07a.cpp:84</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a38e5de3cf4f88f0f731946f091eb5849"><div class="ttname"><a href="xsample07a_8cpp.html#a38e5de3cf4f88f0f731946f091eb5849">translate_kmer</a></div><div class="ttdeci">void translate_kmer(std::string &amp;dna, bm::id64_t kmer_code, unsigned k_size)</div><div class="ttdoc">Translate k-mer code into ATGC DNA string.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00444">xsample07a.cpp:444</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a3f1ef71b34674c4f7926bc05778037c7"><div class="ttname"><a href="xsample07a_8cpp.html#a3f1ef71b34674c4f7926bc05778037c7">save_kmer_buffers</a></div><div class="ttdeci">static void save_kmer_buffers(const std::string &amp;fname, const CSequenceColl &amp;seq_coll)</div><div class="ttdoc">save k-mer vectors to a file</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00294">xsample07a.cpp:294</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a4ca03dfc387c36e69ea916426572acdc"><div class="ttname"><a href="xsample07a_8cpp.html#a4ca03dfc387c36e69ea916426572acdc">bvector_type</a></div><div class="ttdeci">bm::bvector bvector_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00094">xsample07a.cpp:94</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a4dd1e4b402061691109d356faa4513b5"><div class="ttname"><a href="xsample07a_8cpp.html#a4dd1e4b402061691109d356faa4513b5">is_bench</a></div><div class="ttdeci">bool is_bench</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00083">xsample07a.cpp:83</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a540384e904d19ef31d71381b604fedf5"><div class="ttname"><a href="xsample07a_8cpp.html#a540384e904d19ef31d71381b604fedf5">kh_name</a></div><div class="ttdeci">std::string kh_name</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00078">xsample07a.cpp:78</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a57fb672ff6d3e743da75e0d98120e714"><div class="ttname"><a href="xsample07a_8cpp.html#a57fb672ff6d3e743da75e0d98120e714">load_FASTA</a></div><div class="ttdeci">static int load_FASTA(const std::string &amp;fname, CSequenceColl &amp;seq_coll)</div><div class="ttdoc">Load multi-sequence FASTA.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00244">xsample07a.cpp:244</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a6df282f999b658952c4a5423e2465d95"><div class="ttname"><a href="xsample07a_8cpp.html#a6df282f999b658952c4a5423e2465d95">compute_and_sim_row</a></div><div class="ttdeci">static void compute_and_sim_row(unsigned *row, const bm::bvector&lt;&gt; *bv_i, size_t i, const std::vector&lt; std::unique_ptr&lt; bvector_type &gt; &gt; &amp;k_mers_vect)</div><div class="ttdoc">Compute similarity distances for one row/vector (1:N) of distance matrix.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00890">xsample07a.cpp:890</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a7abca04faa4bc9e482801161aed87e64"><div class="ttname"><a href="xsample07a_8cpp.html#a7abca04faa4bc9e482801161aed87e64">bv_ranges_vector</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; bv_size_type, bv_size_type &gt; &gt; bv_ranges_vector</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00099">xsample07a.cpp:99</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a804134333821912f3013d1ab32f3e956"><div class="ttname"><a href="xsample07a_8cpp.html#a804134333821912f3013d1ab32f3e956">load_kmer_buffers</a></div><div class="ttdeci">static void load_kmer_buffers(const std::string &amp;fname, CSequenceColl &amp;seq_coll)</div><div class="ttdoc">Load k-mer vectors.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00332">xsample07a.cpp:332</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a86fb99116b47ce90217491648448fa46"><div class="ttname"><a href="xsample07a_8cpp.html#a86fb99116b47ce90217491648448fa46">distance_matrix_type</a></div><div class="ttdeci">bm::dynamic_heap_matrix&lt; unsigned, bm::bvector&lt;&gt;::allocator_type &gt; distance_matrix_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00096">xsample07a.cpp:96</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a8ec9c8a1508f6c641c7de6368a3b0f9d"><div class="ttname"><a href="xsample07a_8cpp.html#a8ec9c8a1508f6c641c7de6368a3b0f9d">ikd_freq_name</a></div><div class="ttdeci">std::string ikd_freq_name</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00080">xsample07a.cpp:80</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9651708880643e05b74b997d6b3048d4"><div class="ttname"><a href="xsample07a_8cpp.html#a9651708880643e05b74b997d6b3048d4">ikd_counts_name</a></div><div class="ttdeci">std::string ikd_counts_name</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00077">xsample07a.cpp:77</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9988650f5c236d5a70e710498d62904c"><div class="ttname"><a href="xsample07a_8cpp.html#a9988650f5c236d5a70e710498d62904c">ifa_name</a></div><div class="ttdeci">std::string ifa_name</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00075">xsample07a.cpp:75</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9a7564431a6efa1c032b22070d822a3b"><div class="ttname"><a href="xsample07a_8cpp.html#a9a7564431a6efa1c032b22070d822a3b">compute_group</a></div><div class="ttdeci">static void compute_group(CSeqGroup &amp;seq_group, const CSequenceColl &amp;seq_coll, const bm::bvector&lt;&gt; &amp;bv_exceptions, float similarity_cut_off)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01102">xsample07a.cpp:1102</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9af53e7294c27eb2b80c9e99204e9c09"><div class="ttname"><a href="xsample07a_8cpp.html#a9af53e7294c27eb2b80c9e99204e9c09">ikd_name</a></div><div class="ttdeci">std::string ikd_name</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00076">xsample07a.cpp:76</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9b207270879387c1ad40988b11caf1bc"><div class="ttname"><a href="xsample07a_8cpp.html#a9b207270879387c1ad40988b11caf1bc">timing_map</a></div><div class="ttdeci">bm::chrono_taker ::duration_map_type timing_map</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00104">xsample07a.cpp:104</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9c117ca08d50ad62cf8520af2f1e60d7"><div class="ttname"><a href="xsample07a_8cpp.html#a9c117ca08d50ad62cf8520af2f1e60d7">get_kmer_code</a></div><div class="ttdeci">bool get_kmer_code(const char *dna, size_t pos, unsigned k_size, bm::id64_t &amp;k_mer)</div><div class="ttdoc">Calculate k-mer as an unsigned long integer.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00402">xsample07a.cpp:402</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_a9eb066bc7179fb40780c2160bc69a52d"><div class="ttname"><a href="xsample07a_8cpp.html#a9eb066bc7179fb40780c2160bc69a52d">vector_char_type</a></div><div class="ttdeci">std::vector&lt; char &gt; vector_char_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00095">xsample07a.cpp:95</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_aa592d3fbead57ca8423ac5caaccada07"><div class="ttname"><a href="xsample07a_8cpp.html#aa592d3fbead57ca8423ac5caaccada07">is_diag</a></div><div class="ttdeci">bool is_diag</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00081">xsample07a.cpp:81</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_aa961816c64399d669effbc66f555da72"><div class="ttname"><a href="xsample07a_8cpp.html#aa961816c64399d669effbc66f555da72">int2DNA</a></div><div class="ttdeci">char int2DNA(unsigned code)</div><div class="ttdoc">Translate integer code to DNA letter.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00429">xsample07a.cpp:429</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_ac02c2935dcf3510be1130c2222f75247"><div class="ttname"><a href="xsample07a_8cpp.html#ac02c2935dcf3510be1130c2222f75247">generate_k_mer_bvector</a></div><div class="ttdeci">void generate_k_mer_bvector(BV &amp;bv, const vector_char_type &amp;seq_vect, unsigned k_size, std::vector&lt; bm::id64_t &gt; &amp;k_buf, const bm::id64_t chunk_size=400000000)</div><div class="ttdoc">This function turns each k-mer into an integer number and encodes it in a bit-vector (presense vector...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00474">xsample07a.cpp:474</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_accc3eb1888423e72339c37675136fa5f"><div class="ttname"><a href="xsample07a_8cpp.html#accc3eb1888423e72339c37675136fa5f">assign_to_best_cluster_union</a></div><div class="ttdeci">static void assign_to_best_cluster_union(CSeqClusters &amp;cluster_groups, const CSequenceColl &amp;seq_coll, const bm::bvector&lt;&gt; &amp;bv_seq_ids, bm::bvector&lt;&gt;::size_type seq_id_from, bm::bvector&lt;&gt;::size_type seq_id_to)</div><div class="ttdoc">Compute AND similarity to all available clusters assign to the most similar using UNION of k-mers in ...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01315">xsample07a.cpp:1315</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_acd6b21dd706256a4f0512068b8fe5e35"><div class="ttname"><a href="xsample07a_8cpp.html#acd6b21dd706256a4f0512068b8fe5e35">f_percent</a></div><div class="ttdeci">unsigned f_percent</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00086">xsample07a.cpp:86</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_ae5a9b17aa2ea356fc5bf9b02cc8bac01"><div class="ttname"><a href="xsample07a_8cpp.html#ae5a9b17aa2ea356fc5bf9b02cc8bac01">generate_k_mers_parallel</a></div><div class="ttdeci">static void generate_k_mers_parallel(CSequenceColl &amp;seq_coll, unsigned k_size, unsigned concurrency)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00616">xsample07a.cpp:616</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_aeb19f159bbe1dcac8757cbf6b8c9a334"><div class="ttname"><a href="xsample07a_8cpp.html#aeb19f159bbe1dcac8757cbf6b8c9a334">parallel_jobs</a></div><div class="ttdeci">unsigned parallel_jobs</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00085">xsample07a.cpp:85</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_aec839c8041cd92d6a5d1d70e914c53bd"><div class="ttname"><a href="xsample07a_8cpp.html#aec839c8041cd92d6a5d1d70e914c53bd">get_DNA_code</a></div><div class="ttdeci">bool get_DNA_code(char bp, bm::id64_t &amp;dna_code)</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00374">xsample07a.cpp:374</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_aece8e90d91aaea144d41103f7d2825ee"><div class="ttname"><a href="xsample07a_8cpp.html#aece8e90d91aaea144d41103f7d2825ee">is_timing</a></div><div class="ttdeci">bool is_timing</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00082">xsample07a.cpp:82</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_aedd910426139ee0f1e66a713aa8e0ff2"><div class="ttname"><a href="xsample07a_8cpp.html#aedd910426139ee0f1e66a713aa8e0ff2">compute_seq_group_union</a></div><div class="ttdeci">static void compute_seq_group_union(CSeqGroup &amp;seq_group, const CSequenceColl &amp;seq_coll)</div><div class="ttdoc">Compute union (Universe) of all k-mers in the cluster group Implemented as a OR of all k-mer fingerpr...</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00973">xsample07a.cpp:973</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_af1bd58563209753ca7eea0393a9dd237"><div class="ttname"><a href="xsample07a_8cpp.html#af1bd58563209753ca7eea0393a9dd237">resolve_duplicates</a></div><div class="ttdeci">void resolve_duplicates(CSeqGroup &amp;seq_group1, CSeqGroup &amp;seq_group2, const CSequenceColl &amp;seq_coll)</div><div class="ttdoc">Resolve duplicate members between two groups.</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l01155">xsample07a.cpp:1155</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_af667eb15b7b3d2db6766614694c71546"><div class="ttname"><a href="xsample07a_8cpp.html#af667eb15b7b3d2db6766614694c71546">k_mer_progress_count</a></div><div class="ttdeci">std::atomic_ullong k_mer_progress_count(0)</div></div>
<div class="ttc" id="axsample07a_8cpp_html_afb561b8a5624682616e92a027584a8d9"><div class="ttname"><a href="xsample07a_8cpp.html#afb561b8a5624682616e92a027584a8d9">compute_and_sim</a></div><div class="ttdeci">static void compute_and_sim(distance_matrix_type &amp;dm, const CSequenceColl &amp;seq_coll, const bm::bvector&lt;&gt; &amp;bv_mem, bm::bvector&lt;&gt;::size_type bv_mem_cnt, unsigned concurrency)</div><div class="ttdoc">Compute similarity distances matrix (COUNT(AND(a, b))</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00910">xsample07a.cpp:910</a></div></div>
<div class="ttc" id="axsample07a_8cpp_html_afdb21636f12032d3f307f58ac6ebf90a"><div class="ttname"><a href="xsample07a_8cpp.html#afdb21636f12032d3f307f58ac6ebf90a">bvector_ptr_vector_type</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; bvector_type &gt; &gt; bvector_ptr_vector_type</div><div class="ttdef"><b>Definition:</b> <a href="xsample07a_8cpp_source.html#l00097">xsample07a.cpp:97</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
